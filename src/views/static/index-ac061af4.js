import{f as e,i as a,W as o,G as s,g as r,X as l,Y as t,_ as n,r as i,o as d,a as m,k as u,b as c,l as g,I as p,x as f,Z as v,M as h,N as w}from"./index-3ec52a71.js";import{a as x,u as y,t as b}from"./tags-view-b4323d83.js";import{r as F,g as V,s as k,a as _}from"./service-0bae86ac.js";import{u as j}from"./general-396d6035.js";const D=j(),L=e("user",(()=>{const e=a(V()||""),s=x(),r=y(),l=()=>{r.cacheTagsView||(s.delAllVisitedViews(),s.delAllCachedViews())};return{login:a=>{return o=void 0,s=[a],r=function*({username:a,password:o}){const{model:s}=yield(r={username:a,password:o},F({url:"/adm/login",method:"post",data:r}));var r;k(s.token),e.value=s.token,D.setProjectList(s.projectAll)},new Promise(((e,a)=>{var l=e=>{try{n(r.next(e))}catch(o){a(o)}},t=e=>{try{n(r.throw(e))}catch(o){a(o)}},n=a=>a.done?e(a.value):Promise.resolve(a.value).then(l,t);n((r=r.apply(o,s)).next())}));var o,s,r},logout:()=>{_(),e.value="",o(),l()},resetToken:()=>{_(),e.value=""}}})),R={components:{themeSwitch:b},setup(){const e=s(),o=r({username:"admin",password:"12345678"}),n=a(null),i=a(!1);return{loginFormData:o,loginFormRules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:8,max:16,message:"长度在 8 到 16 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入验证码",trigger:"blur"}]},handleLogin:()=>{var a;null==(a=n.value)||a.validate(((a,s)=>{a?(i.value=!0,L().login(o).then((()=>{e.push({path:"/"})})).catch((()=>{o.password=""})).finally((()=>{i.value=!1}))):console.error("表单校验不通过",s)}))},User:l,Lock:t,loading:i,loginFormRef:n}}},U={class:"login-container"},q={class:"login-card"},z=(e=>(h("data-v-a28b13e5"),e=e(),w(),e))((()=>c("div",{class:"title"},[c("img",{src:"/static/logo-647d216c.png"})],-1))),A={class:"content"};const C=n(R,[["render",function(e,a,o,s,r,l){const t=i("themeSwitch"),n=i("el-input"),h=i("el-form-item"),w=i("el-button"),x=i("el-form");return d(),m("div",U,[u(t,{class:"theme-switch"}),c("div",q,[z,c("div",A,[u(x,{ref:"loginFormRef",model:s.loginFormData,rules:s.loginFormRules,onKeyup:v(s.handleLogin,["enter"])},{default:g((()=>[u(h,{prop:"username"},{default:g((()=>[u(n,{modelValue:s.loginFormData.username,"onUpdate:modelValue":a[0]||(a[0]=e=>s.loginFormData.username=e),modelModifiers:{trim:!0},placeholder:"用户名",type:"text",tabindex:"1","prefix-icon":s.User,size:"large"},null,8,["modelValue","prefix-icon"])])),_:1}),u(h,{prop:"password"},{default:g((()=>[u(n,{modelValue:s.loginFormData.password,"onUpdate:modelValue":a[1]||(a[1]=e=>s.loginFormData.password=e),modelModifiers:{trim:!0},placeholder:"密码",type:"password",tabindex:"2","prefix-icon":s.Lock,size:"large","show-password":""},null,8,["modelValue","prefix-icon"])])),_:1}),u(w,{loading:s.loading,type:"primary",size:"large",onClick:p(s.handleLogin,["prevent"])},{default:g((()=>[f("登 录")])),_:1},8,["loading","onClick"])])),_:1},8,["model","rules","onKeyup"])])])])}],["__scopeId","data-v-a28b13e5"]]);export{C as default};
