import{t as a,n as e}from"./index-5ff81ca2.js";import{M as t,p as l,c as s,a as r,b as i}from"./index-9612c962.js";import{u as n}from"./usePagination-c6ea6d74.js";import{J as o,a as c}from"./jsHoursEchart-23dee0f0.js";import{r as d}from"./service-85055b13.js";import{P as p,a as u}from"./index-844208c3.js";import{E as m,l as h}from"./index-a1087001.js";import{c as g,_ as f,r as v,o as b,a as y,k as x,F as P,b as C,g as D,i as T,R as w,l as E,y as _,z as k,A as j,d as S,e as U,n as L,M as z,N as F}from"./index-e4b722a2.js";import"./validate-f5786776.js";const V={components:{Echarts:m},props:{options:{type:Object,required:!0}},name:"wxPerfEchart",setup:a=>({ntFormat:e=>{let t=null==a?void 0:a.options;if(!t||!Object.keys(t).length)return 0;let l=t.NT[e]||0;const s=t.FP||{},r=t.FCP||{},i=t.LCP||{},n=t.NT||{};return"FCP"==e&&r.startTime&&(l=r.startTime-n.appLaunchStartTime),"FP"==e&&Object.keys(s).length&&(l=s.startTime-n.appLaunchStartTime),"LCP"==e&&i.startTime&&(l=i.startTime-n.appLaunchStartTime),Number((l||0).toFixed(2))},navigationEchart:g((()=>{var e;const t=(null==(e=a.options)?void 0:e.NT)||{};if(!t||!Object.keys(t).length)return{};const l=["firstRender","script","route","appLaunch","loadPackage"],s=[],r=[];l.forEach(((a,e)=>{const i=(t[a]||0).toFixed(2);r.push(`${i}ms`);const n={name:a,type:"bar",stack:"Total",label:{show:!0,position:"right"},data:[]};for(let t=0,s=l.length;t<s;t++)e==t?n.data.push(i):n.data.push("-");s.push(n)}));const{script:i=0,route:n=0,loadPackage:o=0,appLaunch:c=0}=t;return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(a){for(let e=1,t=a.length;e<t;e++){let{name:t,value:l,seriesName:s,color:r}=a[e];if("-"!==l)return`${t}</br><span style="display:flex; align-items: center;">\n\t\t\t\t\t<i style="display:block;margin-right:5px;border-radius:50%;width:10px;height:10px;left:5px;background-color:${r}"></i>${s}:\n\t\t\t\t\t<i style="padding-left: 30px;">${l}</i>\n\t\t\t\t</span>`}}},xAxis:{type:"value",show:!1,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}}},yAxis:[{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:["页面渲染","JS注入","路由","小程序启动","代码包下载"]},{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:r}],seriesColorReset:!1,series:[{name:"Placeholder",type:"bar",stack:"Total",silent:!0,itemStyle:{borderColor:"transparent",color:"transparent"},emphasis:{itemStyle:{borderColor:"transparent",color:"transparent"}},data:[`${c+o+n+i}`,`${c+o+n}`,`${c+o}`,`${o}`]},...s]}}))})},$=C("div",{class:"flex flex-row justify-between",style:{width:"100%"}},null,-1);const J={components:{MapEcharts:t,pageHoursEchart:l,JsHoursEchart:o,PerfEchart:p,WxPerfEchart:f(V,[["render",function(a,e,t,l,s,r){const i=v("Echarts");return b(),y(P,null,[$,x(i,{options:l.navigationEchart},null,8,["options"])],64)}]]),Echarts:m},setup(){let t=D({activePage:"",pvCount:0,visitList:[],ipcregion:[],jsErrorTableData:[],perfEchartOPtion:[],project:{},EchartDatas:[],tableData:[]});const l=T({simpleUrl:"",data:a({format:["00:00:00","23:59:59"]})}),{paginationData:o,handleCurrentChange:p,handleSizeChange:m}=n((()=>{f()}),{layout:"total, prev, pager, next, jumper"}),f=async()=>{let a={simpleUrl:l.value.simpleUrl,startTime:l.value.data[0],endTime:l.value.data[1],page:o.currentPage,pageSize:o.pageSize},e=await s(a);e.success&&(t.pvCount=e.model.pvCount,o.total=e.model.count,t.visitList=e.model.list,v(t.visitList[0]||{}))},v=a=>{const{simpleUrl:e=""}=a;t.activePage=e,(async()=>{const a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage};let e=await i(a);if(!e.success)return!1;t.ipcregion=e.model})(),(async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await c(a);e.success&&(t.jsErrorTableData=e.model)})(),x(),P(),C()},b=g((()=>({startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage}))),y=g((()=>({data:l.value.data,simpleUrl:t.activePage}))),x=async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await u(a);e.success&&(t.perfEchartOPtion=e.model,t.project=e.model.project)},P=async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await r(a);e.success&&(t.EchartDatas=e.model)},C=async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await function(a){return d({url:"/adm/api/agregate/list",method:"post",data:a})}(a);e.success&&(t.tableData=e.model)},E={toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},series:[{name:"Nightingale Chart",type:"pie",radius:[20,100],center:["50%","50%"],roseType:"area",itemStyle:{borderRadius:8},data:[]}]},_=g((()=>(a,e=t.EchartDatas)=>{var l;let s=h.cloneDeep(E);const r=e[a];let i=[];return null==(l=r.axisData)||l.forEach(((a,e)=>{i.push({name:a,value:r.seriesData[e]})})),s.series[0].data=i,s})),k=async()=>{f()};return w((()=>{k()})),{data:t,searchData:l,resetSearch:async()=>{l.value={simpleUrl:"",data:a({format:["00:00:00","23:59:59"]})}},init:k,paginationData:o,handleCurrentChange:p,handleSizeChange:m,visitPercent:a=>(a/t.pvCount*100).toFixed(2)+"%",numberFormat:e,handleVisitItem:v,hourPvUvParam:b,hourJsParam:y,echartData:_}}},N=a=>(z("data-v-f5cb2e4d"),a=a(),F(),a),O={class:"app-container"},A={class:"custom-main-contents visit-left-contents"},I={class:"card-header"},R=N((()=>C("span",null,"访问页面",-1))),H={class:"flex-1 flex flex-column"},M=["onClick"],q={class:"flex align-items-center"},B={class:"pager-wrapper mt20"},W={class:"visit-right-contents flex-1 flex flex-column"},G=N((()=>C("div",{class:"card-header"},[C("span",null,"健康概览")],-1))),K=N((()=>C("div",{class:"card-header"},[C("span",null,"JS错误聚类")],-1))),Q=N((()=>C("div",{class:"card-header"},[C("span",null,"API详情")],-1))),X={class:"flex-1 flex flex-column"},Y=N((()=>C("div",{class:"card-header"},[C("span",null,"地理分布")],-1))),Z=N((()=>C("div",{class:"card-header"},[C("span",null,"终端分布")],-1)));const aa=f(J,[["render",function(a,e,t,l,s,r){const i=v("el-input"),n=v("el-form-item"),o=v("el-date-picker"),c=v("el-button"),d=v("el-form"),p=v("el-card"),u=v("ArrowRightBold"),m=v("el-icon"),h=v("el-scrollbar"),g=v("el-pagination"),f=v("pageHoursEchart"),D=v("el-tab-pane"),T=v("JsHoursEchart"),w=v("PerfEchart"),z=v("el-tabs"),F=v("el-table-column"),V=v("el-table"),$=v("MapEcharts"),J=v("Echarts");return b(),y("div",O,[x(p,{class:"search-wrapper"},{default:E((()=>[x(d,{ref:"searchFormRef",inline:!0,model:l.searchData},{default:E((()=>[x(n,{prop:"simpleUrl",label:"页面链接"},{default:E((()=>[x(i,{modelValue:l.searchData.simpleUrl,"onUpdate:modelValue":e[0]||(e[0]=a=>l.searchData.simpleUrl=a),placeholder:"请输入带*的页面链接"},null,8,["modelValue"])])),_:1}),x(n,{prop:"phone",label:"日期"},{default:E((()=>[x(o,{modelValue:l.searchData.data,"onUpdate:modelValue":e[1]||(e[1]=a=>l.searchData.data=a),type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])])),_:1}),x(n,null,{default:E((()=>[x(c,{type:"primary",onClick:l.init},{default:E((()=>[_("查询")])),_:1},8,["onClick"]),x(c,{onClick:l.resetSearch},{default:E((()=>[_("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1}),C("section",A,[x(p,{class:"flex flex-1 flex-column visit-left-list"},{header:E((()=>[C("div",I,[R,C("span",null,"总PV: "+k(l.data.pvCount)+"次",1)])])),default:E((()=>[C("div",H,[x(h,null,{default:E((()=>[(b(!0),y(P,null,j(l.data.visitList,((a,e)=>(b(),y("dl",{class:L(["arco-list-item",{active:l.data.activePage==a.simpleUrl}]),key:e,onClick:e=>l.handleVisitItem(a)},[C("dt",null,k(a.simpleUrl),1),C("dd",q,[_(k(l.numberFormat(a.pageCount))+"次("+k(l.visitPercent(a.pageCount))+") ",1),x(m,null,{default:E((()=>[x(u)])),_:1})])],10,M)))),128))])),_:1}),C("div",B,[x(g,{background:"",layout:l.paginationData.layout,"page-sizes":l.paginationData.pageSizes,total:l.paginationData.total,"page-size":l.paginationData.pageSize,currentPage:l.paginationData.currentPage,onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])])),_:1}),C("div",W,[x(h,null,{default:E((()=>[x(p,null,{header:E((()=>[G])),default:E((()=>[x(z,{class:"demo-tabs"},{default:E((()=>[x(D,{label:"pv/uv"},{default:E((()=>[x(f,{params:l.hourPvUvParam},null,8,["params"])])),_:1}),x(D,{label:"JS报错"},{default:E((()=>[x(T,{params:l.hourJsParam},null,8,["params"])])),_:1}),1==l.data.project.projectType?(b(),S(D,{key:0,label:"平均性能"},{default:E((()=>[x(w,{options:l.data.perfEchartOPtion},null,8,["options"])])),_:1})):U("",!0)])),_:1})])),_:1}),x(p,{class:"mt20"},{header:E((()=>[K])),default:E((()=>[x(V,{data:l.data.jsErrorTableData,border:"",style:{width:"100%"}},{default:E((()=>[x(F,{prop:"errorMsg",label:"错误内容"}),x(F,{prop:"count",label:"错误数"}),x(F,{prop:"userCount",label:"影响用户数"})])),_:1},8,["data"])])),_:1}),x(p,{class:"mt20"},{header:E((()=>[Q])),default:E((()=>[C("div",X,[x(V,{border:"",data:l.data.tableData},{default:E((()=>[x(F,{prop:"pathName",label:"API名称",align:"left"}),x(F,{prop:"method",label:"请求方式",align:"center"}),x(F,{prop:"count",label:"请求次数",align:"center"}),x(F,{prop:"avgDuration",label:"平均耗时（ms）",align:"center"}),x(F,{prop:"avgDuration",label:"请求成功率",align:"center"},{default:E((({row:a})=>[_(k(100*(a.successCount/a.count).toFixed(2))+"% ",1)])),_:1})])),_:1},8,["data"])])])),_:1}),x(p,{class:"mt20"},{header:E((()=>[Y])),default:E((()=>[x($,{ipCregion:l.data.ipcregion},null,8,["ipCregion"])])),_:1}),x(p,{class:"mt20"},{header:E((()=>[Z])),default:E((()=>[x(z,{class:"demo-tabs"},{default:E((()=>[l.data.EchartDatas.os?(b(),S(D,{key:0,label:"系统版本"},{default:E((()=>[x(J,{options:l.echartData("os")},null,8,["options"])])),_:1})):U("",!0),l.data.EchartDatas.device?(b(),S(D,{key:1,label:"浏览设备"},{default:E((()=>[x(J,{options:l.echartData("device")},null,8,["options"])])),_:1})):U("",!0),l.data.EchartDatas.browser?(b(),S(D,{key:2,label:"浏览器版本"},{default:E((()=>[x(J,{options:l.echartData("browser")},null,8,["options"])])),_:1})):U("",!0),l.data.EchartDatas.screen?(b(),S(D,{key:3,label:"设备分辨率"},{default:E((()=>[x(J,{options:l.echartData("screen")},null,8,["options"])])),_:1})):U("",!0)])),_:1})])),_:1})])),_:1})])])])}],["__scopeId","data-v-f5cb2e4d"]]);export{aa as default};
