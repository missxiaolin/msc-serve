import{t as a,n as e}from"./index-413a2c48.js";import{M as t,p as s,c as l,a as r,b as i}from"./index-85448423.js";import{u as n}from"./usePagination-ebe6ff71.js";import{J as o,a as c}from"./jsHoursEchart-c0c84033.js";import{r as d}from"./service-3e5cfaca.js";import{E as p,l as u}from"./index-267f45a2.js";import{c as m,_ as h,r as g,o as f,a as v,b as y,k as b,l as x,F as T,y as P,g as C,i as D,R as w,z as k,A as S,d as E,e as _,n as F,M as L,N as j}from"./index-a9cc547b.js";const $={class:"flex flex-row justify-between",style:{width:"100%"}};const U=h({components:{Echarts:p},props:{options:{type:Object,required:!0}},name:"perfEchart",setup:a=>({ntFormat:e=>{let t=null==a?void 0:a.options;if(!t||!Object.keys(t).length)return 0;let s=t.NT[e]||0;if(!s&&0===s)return 0;const l=t.FP||{},r=t.FCP||{};return"FP"==e&&Object.keys(l).length&&(s=l.startTime),"FPC"==e&&Object.keys(r).length&&(s=r.startTime),Number((s||0).toFixed(2))},navigationEchart:m((()=>{var e;const t=(null==(e=a.options)?void 0:e.NT)||{};if(!t||!Object.keys(t).length)return{};const s=["DomReady","Res","DomParse","Trans","TTFB","SSL","TCP","DNS"],l=[],r=[];s.forEach(((a,e)=>{const i=(t[a]||0).toFixed(2);r.push(`${i}ms`);const n={name:a,type:"bar",stack:"Total",label:{show:!0,position:"right"},data:[]};for(let t=0,l=s.length;t<l;t++)e==t?n.data.push(i):n.data.push("-");l.push(n)}));const{DomParse:i=0,Res:n=0,Trans:o=0,TTFB:c=0,TCP:d=0,SSL:p=0,DNS:u=0}=t;return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(a){for(let e=1,t=a.length;e<t;e++){let{name:t,value:s,seriesName:l,color:r}=a[e];if("-"!==s)return`${t}</br><span style="display:flex; align-items: center;">\n\t\t\t\t\t<i style="display:block;margin-right:5px;border-radius:50%;width:10px;height:10px;left:5px;background-color:${r}"></i>${l}:\n\t\t\t\t\t<i style="padding-left: 30px;">${s}</i>\n\t\t\t\t</span>`}}},xAxis:{type:"value",show:!1,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}}},yAxis:[{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:["DOM准备","资源加载","DOM解析","内容传输","请求响应","SSL建连","TCP链接","DNS查询"]},{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:r}],seriesColorReset:!1,series:[{name:"Placeholder",type:"bar",stack:"Total",silent:!0,itemStyle:{borderColor:"transparent",color:"transparent"},emphasis:{itemStyle:{borderColor:"transparent",color:"transparent"}},data:[`${n+i+c+d+p+u}`,`${i+c+d+p+u}`,`${o+c+d+p+u}`,`${c+d+p+u}`,`${d+p+u}`,`${d+u}`,`${u}`,`${u}`]},...l]}}))})},[["render",function(a,e,t,s,l,r){const i=g("el-statistic"),n=g("Echarts");return f(),v(T,null,[y("div",$,[b(i,{title:"白屏时间",value:s.ntFormat("FP")},{suffix:x((()=>[P("ms")])),_:1},8,["value"]),b(i,{title:"首字节",value:s.ntFormat("FirseByte")},{suffix:x((()=>[P("ms")])),_:1},8,["value"]),b(i,{title:"DOM Ready",value:s.ntFormat("DomReady")},{suffix:x((()=>[P("ms")])),_:1},8,["value"]),b(i,{title:"首次可交互时间",value:s.ntFormat("TTI")},{suffix:x((()=>[P("ms")])),_:1},8,["value"]),b(i,{title:"页面完全加载",value:s.ntFormat("Load")},{suffix:x((()=>[P("ms")])),_:1},8,["value"])]),b(n,{options:s.navigationEchart},null,8,["options"])],64)}]]),N={components:{Echarts:p},props:{options:{type:Object,required:!0}},name:"wxPerfEchart",setup:a=>({ntFormat:e=>{let t=null==a?void 0:a.options;if(!t||!Object.keys(t).length)return 0;let s=t.NT[e]||0;const l=t.FP||{},r=t.FCP||{},i=t.LCP||{},n=t.NT||{};return"FCP"==e&&r.startTime&&(s=r.startTime-n.appLaunchStartTime),"FP"==e&&Object.keys(l).length&&(s=l.startTime-n.appLaunchStartTime),"LCP"==e&&i.startTime&&(s=i.startTime-n.appLaunchStartTime),Number((s||0).toFixed(2))},navigationEchart:m((()=>{var e;const t=(null==(e=a.options)?void 0:e.NT)||{};if(!t||!Object.keys(t).length)return{};const s=["firstRender","script","route","appLaunch","loadPackage"],l=[],r=[];s.forEach(((a,e)=>{const i=(t[a]||0).toFixed(2);r.push(`${i}ms`);const n={name:a,type:"bar",stack:"Total",label:{show:!0,position:"right"},data:[]};for(let t=0,l=s.length;t<l;t++)e==t?n.data.push(i):n.data.push("-");l.push(n)}));const{script:i=0,route:n=0,loadPackage:o=0,appLaunch:c=0}=t;return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(a){for(let e=1,t=a.length;e<t;e++){let{name:t,value:s,seriesName:l,color:r}=a[e];if("-"!==s)return`${t}</br><span style="display:flex; align-items: center;">\n\t\t\t\t\t<i style="display:block;margin-right:5px;border-radius:50%;width:10px;height:10px;left:5px;background-color:${r}"></i>${l}:\n\t\t\t\t\t<i style="padding-left: 30px;">${s}</i>\n\t\t\t\t</span>`}}},xAxis:{type:"value",show:!1,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}}},yAxis:[{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:["页面渲染","JS注入","路由","小程序启动","代码包下载"]},{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:r}],seriesColorReset:!1,series:[{name:"Placeholder",type:"bar",stack:"Total",silent:!0,itemStyle:{borderColor:"transparent",color:"transparent"},emphasis:{itemStyle:{borderColor:"transparent",color:"transparent"}},data:[`${c+o+n+i}`,`${c+o+n}`,`${c+o}`,`${o}`]},...l]}}))})},z=y("div",{class:"flex flex-row justify-between",style:{width:"100%"}},null,-1);const O={components:{MapEcharts:t,pageHoursEchart:s,JsHoursEchart:o,PerfEchart:U,WxPerfEchart:h(N,[["render",function(a,e,t,s,l,r){const i=g("Echarts");return f(),v(T,null,[z,b(i,{options:s.navigationEchart},null,8,["options"])],64)}]]),Echarts:p},setup(){let t=C({activePage:"",pvCount:0,visitList:[],ipcregion:[],jsErrorTableData:[],perfEchartOPtion:[],project:{},EchartDatas:[],tableData:[]});const s=D({simpleUrl:"",data:a({format:["00:00:00","23:59:59"]})}),{paginationData:o,handleCurrentChange:p,handleSizeChange:h}=n((()=>{g()}),{layout:"total, prev, pager, next, jumper"}),g=async()=>{let a={simpleUrl:s.value.simpleUrl,startTime:s.value.data[0],endTime:s.value.data[1],page:o.currentPage,pageSize:o.pageSize},e=await l(a);e.success&&(t.pvCount=e.model.pvCount,o.total=e.model.count,t.visitList=e.model.list,f(t.visitList[0]||{}))},f=a=>{const{simpleUrl:e=""}=a;t.activePage=e,(async()=>{const a={startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:t.activePage};let e=await i(a);if(!e.success)return!1;t.ipcregion=e.model})(),(async()=>{let a={startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:t.activePage},e=await c(a);e.success&&(t.jsErrorTableData=e.model)})(),b(),x(),T()},v=m((()=>({startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:t.activePage}))),y=m((()=>({data:s.value.data,simpleUrl:t.activePage}))),b=async()=>{},x=async()=>{let a={startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:t.activePage},e=await r(a);e.success&&(t.EchartDatas=e.model)},T=async()=>{let a={startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:t.activePage},e=await function(a){return d({url:"/adm/api/agregate/list",method:"post",data:a})}(a);e.success&&(t.tableData=e.model)},P={toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},series:[{name:"Nightingale Chart",type:"pie",radius:[20,100],center:["50%","50%"],roseType:"area",itemStyle:{borderRadius:8},data:[]}]},k=m((()=>(a,e=t.EchartDatas)=>{var s;let l=u.cloneDeep(P);const r=e[a];let i=[];return null==(s=r.axisData)||s.forEach(((a,e)=>{i.push({name:a,value:r.seriesData[e]})})),l.series[0].data=i,l})),S=async()=>{g()};return w((()=>{S()})),{data:t,searchData:s,resetSearch:async()=>{s.value={simpleUrl:"",data:a({format:["00:00:00","23:59:59"]})}},init:S,paginationData:o,handleCurrentChange:p,handleSizeChange:h,visitPercent:a=>(a/t.pvCount*100).toFixed(2)+"%",numberFormat:e,handleVisitItem:f,hourPvUvParam:v,hourJsParam:y,echartData:k}}},R=a=>(L("data-v-b8d1ab6c"),a=a(),j(),a),V={class:"app-container"},A={class:"custom-main-contents visit-left-contents"},J={class:"card-header"},M=R((()=>y("span",null,"访问页面",-1))),I={class:"flex-1 flex flex-column"},H=["onClick"],B={class:"flex align-items-center"},q={class:"pager-wrapper mt20"},W={class:"visit-right-contents flex-1 flex flex-column"},G=R((()=>y("div",{class:"card-header"},[y("span",null,"健康概览")],-1))),K=R((()=>y("div",{class:"card-header"},[y("span",null,"JS错误聚类")],-1))),Q=R((()=>y("div",{class:"card-header"},[y("span",null,"API详情")],-1))),X={class:"flex-1 flex flex-column"},Y=R((()=>y("div",{class:"card-header"},[y("span",null,"地理分布")],-1))),Z=R((()=>y("div",{class:"card-header"},[y("span",null,"终端分布")],-1)));const aa=h(O,[["render",function(a,e,t,s,l,r){const i=g("el-input"),n=g("el-form-item"),o=g("el-date-picker"),c=g("el-button"),d=g("el-form"),p=g("el-card"),u=g("ArrowRightBold"),m=g("el-icon"),h=g("el-scrollbar"),C=g("el-pagination"),D=g("pageHoursEchart"),w=g("el-tab-pane"),L=g("JsHoursEchart"),j=g("el-tabs"),$=g("el-table-column"),U=g("el-table"),N=g("MapEcharts"),z=g("Echarts");return f(),v("div",V,[b(p,{class:"search-wrapper"},{default:x((()=>[b(d,{ref:"searchFormRef",inline:!0,model:s.searchData},{default:x((()=>[b(n,{prop:"simpleUrl",label:"页面链接"},{default:x((()=>[b(i,{modelValue:s.searchData.simpleUrl,"onUpdate:modelValue":e[0]||(e[0]=a=>s.searchData.simpleUrl=a),placeholder:"请输入带*的页面链接"},null,8,["modelValue"])])),_:1}),b(n,{prop:"phone",label:"日期"},{default:x((()=>[b(o,{modelValue:s.searchData.data,"onUpdate:modelValue":e[1]||(e[1]=a=>s.searchData.data=a),type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])])),_:1}),b(n,null,{default:x((()=>[b(c,{type:"primary",onClick:s.init},{default:x((()=>[P("查询")])),_:1},8,["onClick"]),b(c,{onClick:s.resetSearch},{default:x((()=>[P("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1}),y("section",A,[b(p,{class:"flex flex-1 flex-column visit-left-list"},{header:x((()=>[y("div",J,[M,y("span",null,"总PV: "+k(s.data.pvCount)+"次",1)])])),default:x((()=>[y("div",I,[b(h,null,{default:x((()=>[(f(!0),v(T,null,S(s.data.visitList,((a,e)=>(f(),v("dl",{class:F(["arco-list-item",{active:s.data.activePage==a.simpleUrl}]),key:e,onClick:e=>s.handleVisitItem(a)},[y("dt",null,k(a.simpleUrl),1),y("dd",B,[P(k(s.numberFormat(a.pageCount))+"次("+k(s.visitPercent(a.pageCount))+") ",1),b(m,null,{default:x((()=>[b(u)])),_:1})])],10,H)))),128))])),_:1}),y("div",q,[b(C,{background:"",layout:s.paginationData.layout,"page-sizes":s.paginationData.pageSizes,total:s.paginationData.total,"page-size":s.paginationData.pageSize,currentPage:s.paginationData.currentPage,onSizeChange:s.handleSizeChange,onCurrentChange:s.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])])),_:1}),y("div",W,[b(h,null,{default:x((()=>[b(p,null,{header:x((()=>[G])),default:x((()=>[b(j,{class:"demo-tabs"},{default:x((()=>[b(w,{label:"pv/uv"},{default:x((()=>[b(D,{params:s.hourPvUvParam},null,8,["params"])])),_:1}),b(w,{label:"JS报错"},{default:x((()=>[b(L,{params:s.hourJsParam},null,8,["params"])])),_:1})])),_:1})])),_:1}),b(p,{class:"mt20"},{header:x((()=>[K])),default:x((()=>[b(U,{data:s.data.jsErrorTableData,border:"",style:{width:"100%"}},{default:x((()=>[b($,{prop:"errorMsg",label:"错误内容"}),b($,{prop:"count",label:"错误数"}),b($,{prop:"userCount",label:"影响用户数"})])),_:1},8,["data"])])),_:1}),b(p,{class:"mt20"},{header:x((()=>[Q])),default:x((()=>[y("div",X,[b(U,{border:"",data:s.data.tableData},{default:x((()=>[b($,{prop:"pathName",label:"API名称",align:"left"}),b($,{prop:"method",label:"请求方式",align:"center"}),b($,{prop:"count",label:"请求次数",align:"center"}),b($,{prop:"avgDuration",label:"平均耗时（ms）",align:"center"}),b($,{prop:"avgDuration",label:"请求成功率",align:"center"},{default:x((({row:a})=>[P(k(100*(a.successCount/a.count).toFixed(2))+"% ",1)])),_:1})])),_:1},8,["data"])])])),_:1}),b(p,{class:"mt20"},{header:x((()=>[Y])),default:x((()=>[b(N,{ipCregion:s.data.ipcregion},null,8,["ipCregion"])])),_:1}),b(p,{class:"mt20"},{header:x((()=>[Z])),default:x((()=>[b(j,{class:"demo-tabs"},{default:x((()=>[s.data.EchartDatas.os?(f(),E(w,{key:0,label:"系统版本"},{default:x((()=>[b(z,{options:s.echartData("os")},null,8,["options"])])),_:1})):_("",!0),s.data.EchartDatas.device?(f(),E(w,{key:1,label:"浏览设备"},{default:x((()=>[b(z,{options:s.echartData("device")},null,8,["options"])])),_:1})):_("",!0),s.data.EchartDatas.browser?(f(),E(w,{key:2,label:"浏览器版本"},{default:x((()=>[b(z,{options:s.echartData("browser")},null,8,["options"])])),_:1})):_("",!0),s.data.EchartDatas.screen?(f(),E(w,{key:3,label:"设备分辨率"},{default:x((()=>[b(z,{options:s.echartData("screen")},null,8,["options"])])),_:1})):_("",!0)])),_:1})])),_:1})])),_:1})])])])}],["__scopeId","data-v-b8d1ab6c"]]);export{aa as default};
