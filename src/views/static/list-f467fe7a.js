import{t as a,n as e}from"./index-042dd7a6.js";import{M as t,p as l,c as s,a as r,b as n}from"./index-d4cfa310.js";import{u as o}from"./usePagination-f4d02881.js";import{J as i,a as c}from"./jsHoursEchart-d6f3e120.js";import{r as d}from"./service-4a0bd1ba.js";import{E as p,l as u}from"./index-aea29cd4.js";import{c as h,_ as m,r as g,o as f,a as y,k as v,F as b,b as x,g as P,i as w,R as C,l as T,y as k,z as D,A as E,d as S,e as _,n as L,M as j,N as $}from"./index-550e806e.js";const U={components:{Echarts:p},props:{options:{type:Object,required:!0}},name:"perfEchart",setup:a=>({ntFormat:e=>{let t=null==a?void 0:a.options;if(!t||!Object.keys(t).length)return 0;let l=t.NT[e]||0;if(!l&&0===l)return 0;const s=t.FP||{},r=t.FCP||{};return"FP"==e&&Object.keys(s).length&&(l=s.startTime),"FPC"==e&&Object.keys(r).length&&(l=r.startTime),Number((l||0).toFixed(2))},navigationEchart:h((()=>{var e;const t=(null==(e=a.options)?void 0:e.nt)||{};if(!t||!Object.keys(t).length)return{};const l=["pageLoad","domReady","resourceLoad","domParse","contentDownload","ttfb","ssl","initialConnection","dnsLookup"],s=[],r=[];l.forEach(((a,e)=>{const n=(t[a]||0).toFixed(2);r.push(`${n}ms`);const o={name:a,type:"bar",stack:"Total",label:{show:!0,position:"right"},data:[]};for(let t=0,s=l.length;t<s;t++)e==t?o.data.push(n):o.data.push("-");s.push(o)}));const{pageLoad:n=0,domReady:o=0,resourceLoad:i=0,domParse:c=0,contentDownload:d=0,ttfb:p=0,ssl:u=0,initialConnection:h=0,dnsLookup:m=0}=t;return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(a){for(let e=1,t=a.length;e<t;e++){let{name:t,value:l,seriesName:s,color:r}=a[e];if("-"!==l)return`${t}</br><span style="display:flex; align-items: center;">\n\t\t\t\t\t<i style="display:block;margin-right:5px;border-radius:50%;width:10px;height:10px;left:5px;background-color:${r}"></i>${s}:\n\t\t\t\t\t<i style="padding-left: 30px;">${l}</i>\n\t\t\t\t</span>`}}},xAxis:{type:"value",show:!1,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}}},yAxis:[{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:["页面完全加载","DOM完成加载","资源加载耗时","DOM解析耗时","内容传输耗时","请求响应耗时","SSL安全连接耗时","TCP连接耗时","DNS查询耗时"]},{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:r}],seriesColorReset:!1,series:[{name:"Placeholder",type:"bar",stack:"Total",silent:!0,itemStyle:{borderColor:"transparent",color:"transparent"},emphasis:{itemStyle:{borderColor:"transparent",color:"transparent"}},data:[`${n+o+i+c+d+p+u+h+m}`,`${o+i+c+d+p+u+h+m}`,`${i+c+d+p+u+h+m}`,`${c+d+p+u+h+m}`,`${d+p+u+h+m}`,`${p+u+h+m}`,`${u+h+m}`,`${h+m}`,`${m}`]},...s]}}))})},F=x("div",{class:"flex flex-row justify-between",style:{width:"100%"}},null,-1);const O=m(U,[["render",function(a,e,t,l,s,r){const n=g("Echarts");return f(),y(b,null,[F,v(n,{options:l.navigationEchart},null,8,["options"])],64)}]]),z={components:{Echarts:p},props:{options:{type:Object,required:!0}},name:"wxPerfEchart",setup:a=>({ntFormat:e=>{let t=null==a?void 0:a.options;if(!t||!Object.keys(t).length)return 0;let l=t.NT[e]||0;const s=t.FP||{},r=t.FCP||{},n=t.LCP||{},o=t.NT||{};return"FCP"==e&&r.startTime&&(l=r.startTime-o.appLaunchStartTime),"FP"==e&&Object.keys(s).length&&(l=s.startTime-o.appLaunchStartTime),"LCP"==e&&n.startTime&&(l=n.startTime-o.appLaunchStartTime),Number((l||0).toFixed(2))},navigationEchart:h((()=>{var e;const t=(null==(e=a.options)?void 0:e.NT)||{};if(!t||!Object.keys(t).length)return{};const l=["firstRender","script","route","appLaunch","loadPackage"],s=[],r=[];l.forEach(((a,e)=>{const n=(t[a]||0).toFixed(2);r.push(`${n}ms`);const o={name:a,type:"bar",stack:"Total",label:{show:!0,position:"right"},data:[]};for(let t=0,s=l.length;t<s;t++)e==t?o.data.push(n):o.data.push("-");s.push(o)}));const{script:n=0,route:o=0,loadPackage:i=0,appLaunch:c=0}=t;return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(a){for(let e=1,t=a.length;e<t;e++){let{name:t,value:l,seriesName:s,color:r}=a[e];if("-"!==l)return`${t}</br><span style="display:flex; align-items: center;">\n\t\t\t\t\t<i style="display:block;margin-right:5px;border-radius:50%;width:10px;height:10px;left:5px;background-color:${r}"></i>${s}:\n\t\t\t\t\t<i style="padding-left: 30px;">${l}</i>\n\t\t\t\t</span>`}}},xAxis:{type:"value",show:!1,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}}},yAxis:[{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:["页面渲染","JS注入","路由","小程序启动","代码包下载"]},{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:r}],seriesColorReset:!1,series:[{name:"Placeholder",type:"bar",stack:"Total",silent:!0,itemStyle:{borderColor:"transparent",color:"transparent"},emphasis:{itemStyle:{borderColor:"transparent",color:"transparent"}},data:[`${c+i+o+n}`,`${c+i+o}`,`${c+i}`,`${i}`]},...s]}}))})},N=x("div",{class:"flex flex-row justify-between",style:{width:"100%"}},null,-1);const V={components:{MapEcharts:t,pageHoursEchart:l,JsHoursEchart:i,PerfEchart:O,WxPerfEchart:m(z,[["render",function(a,e,t,l,s,r){const n=g("Echarts");return f(),y(b,null,[N,v(n,{options:l.navigationEchart},null,8,["options"])],64)}]]),Echarts:p},setup(){let t=P({activePage:"",pvCount:0,visitList:[],ipcregion:[],jsErrorTableData:[],perfEchartOPtion:[],project:{},EchartDatas:[],tableData:[]});const l=w({simpleUrl:"",data:a({format:["00:00:00","23:59:59"]})}),{paginationData:i,handleCurrentChange:p,handleSizeChange:m}=o((()=>{g()}),{layout:"total, prev, pager, next, jumper"}),g=async()=>{let a={simpleUrl:l.value.simpleUrl,startTime:l.value.data[0],endTime:l.value.data[1],page:i.currentPage,pageSize:i.pageSize},e=await s(a);e.success&&(t.pvCount=e.model.pvCount,i.total=e.model.count,t.visitList=e.model.list,f(t.visitList[0]||{}))},f=a=>{const{simpleUrl:e=""}=a;t.activePage=e,(async()=>{const a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage};let e=await n(a);if(!e.success)return!1;t.ipcregion=e.model})(),(async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await c(a);e.success&&(t.jsErrorTableData=e.model)})(),b(),x(),T()},y=h((()=>({startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage}))),v=h((()=>({data:l.value.data,simpleUrl:t.activePage}))),b=async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await function(a){return d({url:"/adm/performance/echart/by/url",method:"post",data:a})}(a);e.success&&(t.perfEchartOPtion=e.model,t.project=e.model.project)},x=async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await r(a);e.success&&(t.EchartDatas=e.model)},T=async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await function(a){return d({url:"/adm/api/agregate/list",method:"post",data:a})}(a);e.success&&(t.tableData=e.model)},k={toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},series:[{name:"Nightingale Chart",type:"pie",radius:[20,100],center:["50%","50%"],roseType:"area",itemStyle:{borderRadius:8},data:[]}]},D=h((()=>(a,e=t.EchartDatas)=>{var l;let s=u.cloneDeep(k);const r=e[a];let n=[];return null==(l=r.axisData)||l.forEach(((a,e)=>{n.push({name:a,value:r.seriesData[e]})})),s.series[0].data=n,s})),E=async()=>{g()};return C((()=>{E()})),{data:t,searchData:l,resetSearch:async()=>{l.value={simpleUrl:"",data:a({format:["00:00:00","23:59:59"]})}},init:E,paginationData:i,handleCurrentChange:p,handleSizeChange:m,visitPercent:a=>(a/t.pvCount*100).toFixed(2)+"%",numberFormat:e,handleVisitItem:f,hourPvUvParam:y,hourJsParam:v,echartData:D}}},A=a=>(j("data-v-f5cb2e4d"),a=a(),$(),a),R={class:"app-container"},J={class:"custom-main-contents visit-left-contents"},M={class:"card-header"},I=A((()=>x("span",null,"访问页面",-1))),H={class:"flex-1 flex flex-column"},q=["onClick"],B={class:"flex align-items-center"},W={class:"pager-wrapper mt20"},G={class:"visit-right-contents flex-1 flex flex-column"},K=A((()=>x("div",{class:"card-header"},[x("span",null,"健康概览")],-1))),Q=A((()=>x("div",{class:"card-header"},[x("span",null,"JS错误聚类")],-1))),X=A((()=>x("div",{class:"card-header"},[x("span",null,"API详情")],-1))),Y={class:"flex-1 flex flex-column"},Z=A((()=>x("div",{class:"card-header"},[x("span",null,"地理分布")],-1))),aa=A((()=>x("div",{class:"card-header"},[x("span",null,"终端分布")],-1)));const ea=m(V,[["render",function(a,e,t,l,s,r){const n=g("el-input"),o=g("el-form-item"),i=g("el-date-picker"),c=g("el-button"),d=g("el-form"),p=g("el-card"),u=g("ArrowRightBold"),h=g("el-icon"),m=g("el-scrollbar"),P=g("el-pagination"),w=g("pageHoursEchart"),C=g("el-tab-pane"),j=g("JsHoursEchart"),$=g("PerfEchart"),U=g("el-tabs"),F=g("el-table-column"),O=g("el-table"),z=g("MapEcharts"),N=g("Echarts");return f(),y("div",R,[v(p,{class:"search-wrapper"},{default:T((()=>[v(d,{ref:"searchFormRef",inline:!0,model:l.searchData},{default:T((()=>[v(o,{prop:"simpleUrl",label:"页面链接"},{default:T((()=>[v(n,{modelValue:l.searchData.simpleUrl,"onUpdate:modelValue":e[0]||(e[0]=a=>l.searchData.simpleUrl=a),placeholder:"请输入带*的页面链接"},null,8,["modelValue"])])),_:1}),v(o,{prop:"phone",label:"日期"},{default:T((()=>[v(i,{modelValue:l.searchData.data,"onUpdate:modelValue":e[1]||(e[1]=a=>l.searchData.data=a),type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])])),_:1}),v(o,null,{default:T((()=>[v(c,{type:"primary",onClick:l.init},{default:T((()=>[k("查询")])),_:1},8,["onClick"]),v(c,{onClick:l.resetSearch},{default:T((()=>[k("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1}),x("section",J,[v(p,{class:"flex flex-1 flex-column visit-left-list"},{header:T((()=>[x("div",M,[I,x("span",null,"总PV: "+D(l.data.pvCount)+"次",1)])])),default:T((()=>[x("div",H,[v(m,null,{default:T((()=>[(f(!0),y(b,null,E(l.data.visitList,((a,e)=>(f(),y("dl",{class:L(["arco-list-item",{active:l.data.activePage==a.simpleUrl}]),key:e,onClick:e=>l.handleVisitItem(a)},[x("dt",null,D(a.simpleUrl),1),x("dd",B,[k(D(l.numberFormat(a.pageCount))+"次("+D(l.visitPercent(a.pageCount))+") ",1),v(h,null,{default:T((()=>[v(u)])),_:1})])],10,q)))),128))])),_:1}),x("div",W,[v(P,{background:"",layout:l.paginationData.layout,"page-sizes":l.paginationData.pageSizes,total:l.paginationData.total,"page-size":l.paginationData.pageSize,currentPage:l.paginationData.currentPage,onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])])),_:1}),x("div",G,[v(m,null,{default:T((()=>[v(p,null,{header:T((()=>[K])),default:T((()=>[v(U,{class:"demo-tabs"},{default:T((()=>[v(C,{label:"pv/uv"},{default:T((()=>[v(w,{params:l.hourPvUvParam},null,8,["params"])])),_:1}),v(C,{label:"JS报错"},{default:T((()=>[v(j,{params:l.hourJsParam},null,8,["params"])])),_:1}),1==l.data.project.projectType?(f(),S(C,{key:0,label:"平均性能"},{default:T((()=>[v($,{options:l.data.perfEchartOPtion},null,8,["options"])])),_:1})):_("",!0)])),_:1})])),_:1}),v(p,{class:"mt20"},{header:T((()=>[Q])),default:T((()=>[v(O,{data:l.data.jsErrorTableData,border:"",style:{width:"100%"}},{default:T((()=>[v(F,{prop:"errorMsg",label:"错误内容"}),v(F,{prop:"count",label:"错误数"}),v(F,{prop:"userCount",label:"影响用户数"})])),_:1},8,["data"])])),_:1}),v(p,{class:"mt20"},{header:T((()=>[X])),default:T((()=>[x("div",Y,[v(O,{border:"",data:l.data.tableData},{default:T((()=>[v(F,{prop:"pathName",label:"API名称",align:"left"}),v(F,{prop:"method",label:"请求方式",align:"center"}),v(F,{prop:"count",label:"请求次数",align:"center"}),v(F,{prop:"avgDuration",label:"平均耗时（ms）",align:"center"}),v(F,{prop:"avgDuration",label:"请求成功率",align:"center"},{default:T((({row:a})=>[k(D(100*(a.successCount/a.count).toFixed(2))+"% ",1)])),_:1})])),_:1},8,["data"])])])),_:1}),v(p,{class:"mt20"},{header:T((()=>[Z])),default:T((()=>[v(z,{ipCregion:l.data.ipcregion},null,8,["ipCregion"])])),_:1}),v(p,{class:"mt20"},{header:T((()=>[aa])),default:T((()=>[v(U,{class:"demo-tabs"},{default:T((()=>[l.data.EchartDatas.os?(f(),S(C,{key:0,label:"系统版本"},{default:T((()=>[v(N,{options:l.echartData("os")},null,8,["options"])])),_:1})):_("",!0),l.data.EchartDatas.device?(f(),S(C,{key:1,label:"浏览设备"},{default:T((()=>[v(N,{options:l.echartData("device")},null,8,["options"])])),_:1})):_("",!0),l.data.EchartDatas.browser?(f(),S(C,{key:2,label:"浏览器版本"},{default:T((()=>[v(N,{options:l.echartData("browser")},null,8,["options"])])),_:1})):_("",!0),l.data.EchartDatas.screen?(f(),S(C,{key:3,label:"设备分辨率"},{default:T((()=>[v(N,{options:l.echartData("screen")},null,8,["options"])])),_:1})):_("",!0)])),_:1})])),_:1})])),_:1})])])])}],["__scopeId","data-v-f5cb2e4d"]]);export{ea as default};
