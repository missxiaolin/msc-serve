import{b as e}from"./index-7ae6524b.js";import{r as a}from"./service-b1cc4e2f.js";import{u as r}from"./usePagination-9a22b26f.js";import{g as l,i as t,R as o,K as u,_ as n,r as m,o as d,a as i,b as s,k as p,l as g,y as c,z as y,F as f,A as b,d as h}from"./index-6141709c.js";const v={setup(){let n=l({isShowPorjectPop:!1,projects:[],errorTypeOption:[{name:"JS告警",value:"JS_ERROR"},{name:"网络请求错误告警",value:"HTTP_LOG"},{name:"页面PV告警",value:"PAGE_PV"},{name:"页面UV告警",value:"PAGE_UV"},{name:"资源告警",value:"RESOURCE_ERROR"},{name:"PROMISE告警",value:"PROMISE_ERROR"}],tableData:[],serviceType:[{name:"等于",value:"="},{name:"小于",value:"<"},{name:"大于",value:">"}],whereTypeOption:[]});const m=t(),d=l({id:0,errorType:"",errorName:"",serviceType:"",whereType:"",timeRangeS:"",maxErrorCount:"",alarmIntervalS:"",isEnable:1,note:"",startHour:"",endHour:"",alertType:[]}),i=l({errorType:[{required:!0,message:"请选择错误类型",trigger:"blur"}],errorName:[{required:!0,message:"请输入错误名称",trigger:"blur"}],serviceType:[{required:!0,message:"请选择参数",trigger:"blur"}],whereType:[{required:!0,message:"请选择参数",trigger:"blur"}],timeRangeS:[{required:!0,message:"请输入报警时间",trigger:"blur"}],maxErrorCount:[{required:!0,message:"请输入报警阈值",trigger:"blur"}],alarmIntervalS:[{required:!0,message:"请输入报警时间间隔",trigger:"blur"}],startHour:[{required:!0,message:"请选择起始时间",trigger:"change"}],endHour:[{required:!0,message:"请选择结束时间",trigger:"change"}]}),s=()=>{n.isShowPorjectPop=!1,d.id=0,d.errorType="",d.errorName="",d.timeRangeS="",d.maxErrorCount="",d.alarmIntervalS="",d.isEnable=1,d.note="",d.startHour="",d.endHour="",d.serviceType="",d.whereType="",d.alertType=[],n.whereTypeOption=[]},{paginationData:p,handleCurrentChange:g,handleSizeChange:c}=r((()=>{y()})),y=async()=>{const e={page:p.currentPage,pageSize:p.pageSize},r=await function(e){return a({url:"/adm/alert/list",method:"post",data:e})}(e);r.success&&(n.tableData=r.model.list,p.total=r.model.count)},f=e=>{n.whereTypeOption="PAGE_PV"==e||"PAGE_UV"==e?[{name:"求和",value:"sum"}]:[{name:"求和",value:"sum"},{name:"单个",value:"single"}]};return o((()=>{(async()=>{let a=await e();a.success&&(n.projects=a.model)})(),y()})),{data:n,handleClose:s,ruleForm:d,rules:i,ruleFormRef:m,submitForm:async e=>{e&&await e.validate((async(e,r)=>{if(e){let e=d,r=await function(e){return a({url:"/adm/alert/save",method:"post",data:e})}(e);r.success?(u({message:"保存成功",type:"success"}),s(),y()):u({message:r.errorMessage,type:"error"})}}))},resetForm:e=>{e&&e.resetFields()},showHandleDetail:e=>{d.id=e.id,d.errorType=e.errorType,d.errorName=e.errorName,d.timeRangeS=e.timeRangeS,d.maxErrorCount=e.maxErrorCount,d.alarmIntervalS=e.alarmIntervalS,d.isEnable=e.isEnable,d.note=e.note,d.startHour=e.startHour,d.endHour=e.endHour,d.alertType=e.alertType,d.serviceType=e.serviceType,d.whereType=e.whereType,f(e.errorType),n.isShowPorjectPop=!0},paginationData:p,handleCurrentChange:g,handleSizeChange:c,errorTypeChange:f}}},T={class:"app-container"},V={class:"flex"},_={class:"table-wrapper"},F={class:"pager-wrapper mt20 justify-end"},S={class:"flex"},w=s("span",null,"最近N秒内：",-1),C=s("span",{style:{margin:"0 5px 0 5px"}},"次",-1),x=s("span",{style:{padding:"0 10px 0 10px"}},"-",-1);const E=n(v,[["render",function(e,a,r,l,t,o){const u=m("el-button"),n=m("el-table-column"),v=m("el-table"),E=m("el-pagination"),P=m("el-card"),R=m("el-option"),H=m("el-select"),U=m("el-form-item"),z=m("el-input"),j=m("el-input-number"),k=m("QuestionFilled"),O=m("el-icon"),D=m("el-tooltip"),q=m("el-radio"),I=m("el-radio-group"),N=m("el-time-picker"),A=m("el-checkbox"),G=m("el-checkbox-group"),M=m("el-form"),J=m("el-dialog");return d(),i("div",T,[s("div",V,[p(u,{type:"primary",onClick:a[0]||(a[0]=e=>l.data.isShowPorjectPop=!0)},{default:g((()=>[c("新增告警")])),_:1})]),p(P,{class:"mt20"},{default:g((()=>[s("div",_,[p(v,{border:"",data:l.data.tableData},{default:g((()=>[p(n,{prop:"name",label:"项目名称",align:"center"}),p(n,{prop:"errorType",label:"错误类型",align:"center"}),p(n,{prop:"errorName",label:"错误名称",align:"center"}),p(n,{prop:"timeRangeS",label:"报警时间范围",align:"center"}),p(n,{prop:"maxErrorCount",label:"报警错误阈值",align:"center"}),p(n,{prop:"alarmIntervalS",label:"报警时间间隔",align:"center"}),p(n,{label:"是否开启",align:"center"},{default:g((({row:e})=>[c(y(0==e.isEnable?"禁用":"开启"),1)])),_:1}),p(n,{label:"告警时间段",align:"center"},{default:g((({row:e})=>[c(y(`${e.startHour}-${e.endHour}`),1)])),_:1}),p(n,{label:"操作",align:"center"},{default:g((({row:e})=>[p(u,{type:"text",onClick:a=>l.showHandleDetail(e)},{default:g((()=>[c(" 修改 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),s("div",F,[p(E,{background:"",layout:l.paginationData.layout,"page-sizes":l.paginationData.pageSizes,total:l.paginationData.total,"page-size":l.paginationData.pageSize,currentPage:l.paginationData.currentPage,onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1}),p(J,{modelValue:l.data.isShowPorjectPop,"onUpdate:modelValue":a[15]||(a[15]=e=>l.data.isShowPorjectPop=e),title:"告警设置",width:"60%","before-close":l.handleClose},{default:g((()=>[s("div",S,[p(M,{ref:"ruleFormRef",model:l.ruleForm,rules:l.rules,"label-width":"120px",size:"default","status-icon":"",class:"pop-form"},{default:g((()=>[p(U,{label:"错误类型",prop:"errorType"},{default:g((()=>[p(H,{modelValue:l.ruleForm.errorType,"onUpdate:modelValue":a[1]||(a[1]=e=>l.ruleForm.errorType=e),onChange:l.errorTypeChange},{default:g((()=>[(d(!0),i(f,null,b(l.data.errorTypeOption,((e,a)=>(d(),h(R,{key:a,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),p(U,{label:"错误名称",prop:"errorName"},{default:g((()=>[p(z,{modelValue:l.ruleForm.errorName,"onUpdate:modelValue":a[2]||(a[2]=e=>l.ruleForm.errorName=e)},null,8,["modelValue"])])),_:1}),p(U,{label:"规则",required:""},{default:g((()=>[w,p(U,{prop:"timeRangeS"},{default:g((()=>[p(z,{style:{width:"120px"},modelValue:l.ruleForm.timeRangeS,"onUpdate:modelValue":a[3]||(a[3]=e=>l.ruleForm.timeRangeS=e)},null,8,["modelValue"])])),_:1}),p(U,{prop:"whereType",style:{margin:"0 0 0 5px"}},{default:g((()=>[p(H,{modelValue:l.ruleForm.whereType,"onUpdate:modelValue":a[4]||(a[4]=e=>l.ruleForm.whereType=e),style:{"margin-right":"5px",width:"140px"}},{default:g((()=>[(d(!0),i(f,null,b(l.data.whereTypeOption,((e,a)=>(d(),h(R,{key:a,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(U,{prop:"serviceType"},{default:g((()=>[p(H,{modelValue:l.ruleForm.serviceType,"onUpdate:modelValue":a[5]||(a[5]=e=>l.ruleForm.serviceType=e),style:{"margin-right":"5px",width:"140px"}},{default:g((()=>[(d(!0),i(f,null,b(l.data.serviceType,((e,a)=>(d(),h(R,{key:a,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(U,{prop:"maxErrorCount"},{default:g((()=>[p(z,{style:{width:"120px"},modelValue:l.ruleForm.maxErrorCount,"onUpdate:modelValue":a[6]||(a[6]=e=>l.ruleForm.maxErrorCount=e)},null,8,["modelValue"])])),_:1}),C])),_:1}),p(U,{label:"报警时间间隔",prop:"alarmIntervalS"},{default:g((()=>[p(j,{modelValue:l.ruleForm.alarmIntervalS,"onUpdate:modelValue":a[7]||(a[7]=e=>l.ruleForm.alarmIntervalS=e),min:1,max:60},null,8,["modelValue"]),p(D,{class:"box-item",effect:"dark",content:"报警后如果未恢复正常，间隔多久重新触发一次告警（最低60s）",placement:"bottom-start"},{default:g((()=>[p(O,{style:{"margin-left":"20px"}},{default:g((()=>[p(k)])),_:1})])),_:1})])),_:1}),p(U,{label:"是否使用",prop:"isEnable"},{default:g((()=>[p(I,{modelValue:l.ruleForm.isEnable,"onUpdate:modelValue":a[8]||(a[8]=e=>l.ruleForm.isEnable=e)},{default:g((()=>[p(q,{label:1},{default:g((()=>[c("使用")])),_:1}),p(q,{label:0},{default:g((()=>[c("禁用")])),_:1})])),_:1},8,["modelValue"])])),_:1}),p(U,{label:"配置说明",prop:"note"},{default:g((()=>[p(z,{modelValue:l.ruleForm.note,"onUpdate:modelValue":a[9]||(a[9]=e=>l.ruleForm.note=e)},null,8,["modelValue"])])),_:1}),p(U,{label:"发送时间段",required:""},{default:g((()=>[p(U,{prop:"startHour"},{default:g((()=>[p(N,{"value-format":"HH:mm:ss",modelValue:l.ruleForm.startHour,"onUpdate:modelValue":a[10]||(a[10]=e=>l.ruleForm.startHour=e),placeholder:"发送开始时间",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),x,p(U,{prop:"endHour"},{default:g((()=>[p(N,{"value-format":"HH:mm:ss",modelValue:l.ruleForm.endHour,"onUpdate:modelValue":a[11]||(a[11]=e=>l.ruleForm.endHour=e),placeholder:"发送结束时间",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),p(U,{label:"告警方式",prop:"alertType"},{default:g((()=>[p(G,{modelValue:l.ruleForm.alertType,"onUpdate:modelValue":a[12]||(a[12]=e=>l.ruleForm.alertType=e)},{default:g((()=>[p(A,{label:1},{default:g((()=>[c("钉钉")])),_:1})])),_:1},8,["modelValue"])])),_:1}),p(U,null,{default:g((()=>[p(u,{type:"primary",onClick:a[13]||(a[13]=e=>l.submitForm(l.ruleFormRef))},{default:g((()=>[c(y(l.ruleForm.id&&0!=l.ruleForm.id?"修改":"添加"),1)])),_:1}),p(u,{onClick:a[14]||(a[14]=e=>l.resetForm(l.ruleFormRef))},{default:g((()=>[c("重置")])),_:1})])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","before-close"])])}]]);export{E as default};
