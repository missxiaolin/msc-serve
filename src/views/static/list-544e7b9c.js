import{b as e}from"./index-13a2d38f.js";import{r as a}from"./service-0e365184.js";import{u as r}from"./usePagination-f5a0e47d.js";import{g as l,i as t,R as o,K as n,_ as u,r as s,o as d,a as m,b as i,k as p,l as _,y as c,z as g,F as f,A as b,d as y}from"./index-affe7dad.js";const h={setup(){let u=l({isShowPorjectPop:!1,projects:[],errorTypeOption:[{name:"JS告警",value:"JS_ERROR"},{name:"网络请求告警",value:"HTTP_LOG"},{name:"页面告警",value:"PAGE_CHANGE"},{name:"资源告警",value:"RESOURCE_ERROR"},{name:"PROMISE告警",value:"PROMISE_ERROR"}],tableData:[]});const s=t(),d=l({id:0,project_id:"",error_type:"",error_name:"",time_range_s:"",max_error_count:"",alarm_interval_s:"",is_enable:1,note:"",startHour:"",endHour:"",alertType:[]}),m=l({project_id:[{required:!0,message:"请选择项目ID",trigger:"blur"}],error_type:[{required:!0,message:"请选择错误类型",trigger:"blur"}],error_name:[{required:!0,message:"请输入错误名称",trigger:"blur"}],time_range_s:[{required:!0,message:"请输入报警时间范围",trigger:"blur"}],max_error_count:[{required:!0,message:"请输入报警阈值",trigger:"blur"}],alarm_interval_s:[{required:!0,message:"请输入报警时间间隔",trigger:"blur"}],startHour:[{required:!0,message:"请选择起始时间",trigger:"change"}],endHour:[{required:!0,message:"请选择结束时间",trigger:"change"}]}),i=()=>{u.isShowPorjectPop=!1,d.id=0,d.project_id="",d.error_type="",d.error_name="",d.time_range_s=0,d.max_error_count=0,d.alarm_interval_s=0,d.is_enable=1,d.note="",d.startHour="",d.endHour="",d.alertType=[]},{paginationData:p,handleCurrentChange:_,handleSizeChange:c}=r((()=>{g()})),g=async()=>{const e={page:p.currentPage,pageSize:p.pageSize},r=await function(e){return a({url:"/adm/alert/list",method:"post",data:e})}(e);r.success&&(u.tableData=r.model.list,p.total=r.model.count)};return o((()=>{(async()=>{let a=await e();a.success&&(u.projects=a.model)})(),g()})),{data:u,handleClose:i,ruleForm:d,rules:m,ruleFormRef:s,submitForm:async e=>{e&&await e.validate((async(e,r)=>{if(e){let e=d,r=await function(e){return a({url:"/adm/alert/save",method:"post",data:e})}(e);r.success?(n({message:"保存成功",type:"success"}),i(),g()):n({message:r.errorMessage,type:"error"})}}))},resetForm:e=>{e&&e.resetFields()},showHandleDetail:e=>{d.id=e.id,d.project_id=e.project_id,d.error_type=e.error_type,d.error_name=e.error_name,d.time_range_s=e.time_range_s,d.max_error_count=e.max_error_count,d.alarm_interval_s=e.alarm_interval_s,d.is_enable=e.is_enable,d.note=e.note,d.startHour=e.startHour,d.endHour=e.endHour,d.alertType=e.alertType,u.isShowPorjectPop=!0},paginationData:p,handleCurrentChange:_,handleSizeChange:c}}},F={class:"app-container"},V={class:"flex"},v={class:"table-wrapper"},x={class:"pager-wrapper mt20 justify-end"},H={class:"flex"},C=i("span",{style:{padding:"0 10px 0 10px"}},"-",-1);const j=u(h,[["render",function(e,a,r,l,t,o){const n=s("el-button"),u=s("el-table-column"),h=s("el-table"),j=s("el-pagination"),w=s("el-card"),P=s("el-option"),S=s("el-select"),R=s("el-form-item"),k=s("el-input"),z=s("el-input-number"),D=s("QuestionFilled"),U=s("el-icon"),T=s("el-tooltip"),q=s("el-radio"),E=s("el-radio-group"),O=s("el-time-picker"),A=s("el-checkbox"),G=s("el-checkbox-group"),I=s("el-form"),M=s("el-dialog");return d(),m("div",F,[i("div",V,[p(n,{type:"primary",onClick:a[0]||(a[0]=e=>l.data.isShowPorjectPop=!0)},{default:_((()=>[c("新增告警")])),_:1})]),p(w,{class:"mt20"},{default:_((()=>[i("div",v,[p(h,{border:"",data:l.data.tableData},{default:_((()=>[p(u,{prop:"name",label:"项目名称",align:"center"}),p(u,{prop:"error_type",label:"错误类型",align:"center"}),p(u,{prop:"error_name",label:"错误名称",align:"center"}),p(u,{prop:"time_range_s",label:"报警时间范围",align:"center"}),p(u,{prop:"max_error_count",label:"报警错误阈值",align:"center"}),p(u,{prop:"alarm_interval_s",label:"报警时间间隔",align:"center"}),p(u,{label:"是否开启",align:"center"},{default:_((({row:e})=>[c(g(0==e.is_enable?"禁用":"开启"),1)])),_:1}),p(u,{label:"告警时间段",align:"center"},{default:_((({row:e})=>[c(g(`${e.startHour}-${e.endHour}`),1)])),_:1}),p(u,{label:"操作",align:"center"},{default:_((({row:e})=>[p(n,{type:"text",onClick:a=>l.showHandleDetail(e)},{default:_((()=>[c(" 修改 ")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),i("div",x,[p(j,{background:"",layout:l.paginationData.layout,"page-sizes":l.paginationData.pageSizes,total:l.paginationData.total,"page-size":l.paginationData.pageSize,currentPage:l.paginationData.currentPage,onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1}),p(M,{modelValue:l.data.isShowPorjectPop,"onUpdate:modelValue":a[14]||(a[14]=e=>l.data.isShowPorjectPop=e),title:"告警设置",width:"60%","before-close":l.handleClose},{default:_((()=>[i("div",H,[p(I,{ref:"ruleFormRef",model:l.ruleForm,rules:l.rules,"label-width":"120px",size:"default","status-icon":"",class:"pop-form"},{default:_((()=>[p(R,{label:"项目",prop:"project_id"},{default:_((()=>[p(S,{modelValue:l.ruleForm.project_id,"onUpdate:modelValue":a[1]||(a[1]=e=>l.ruleForm.project_id=e)},{default:_((()=>[(d(!0),m(f,null,b(l.data.projects,(e=>(d(),y(P,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(R,{label:"错误类型",prop:"error_type"},{default:_((()=>[p(S,{modelValue:l.ruleForm.error_type,"onUpdate:modelValue":a[2]||(a[2]=e=>l.ruleForm.error_type=e)},{default:_((()=>[(d(!0),m(f,null,b(l.data.errorTypeOption,((e,a)=>(d(),y(P,{key:a,label:e.name,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),p(R,{label:"错误名称",prop:"error_name"},{default:_((()=>[p(k,{modelValue:l.ruleForm.error_name,"onUpdate:modelValue":a[3]||(a[3]=e=>l.ruleForm.error_name=e)},null,8,["modelValue"])])),_:1}),p(R,{label:"报警时间范围",prop:"time_range_s"},{default:_((()=>[p(z,{modelValue:l.ruleForm.time_range_s,"onUpdate:modelValue":a[4]||(a[4]=e=>l.ruleForm.time_range_s=e),min:1,max:86400},null,8,["modelValue"]),p(T,{class:"box-item",effect:"dark",content:"时间单位m",placement:"bottom-start"},{default:_((()=>[p(U,{style:{"margin-left":"20px"}},{default:_((()=>[p(D)])),_:1})])),_:1})])),_:1}),p(R,{label:"报警错误阈值",prop:"max_error_count"},{default:_((()=>[p(z,{modelValue:l.ruleForm.max_error_count,"onUpdate:modelValue":a[5]||(a[5]=e=>l.ruleForm.max_error_count=e),min:1,max:100},null,8,["modelValue"]),p(T,{class:"box-item",effect:"dark",content:"表示在多少m内出现相同的错误多少次触发",placement:"bottom-start"},{default:_((()=>[p(U,{style:{"margin-left":"20px"}},{default:_((()=>[p(D)])),_:1})])),_:1})])),_:1}),p(R,{label:"报警时间间隔",prop:"alarm_interval_s"},{default:_((()=>[p(z,{modelValue:l.ruleForm.alarm_interval_s,"onUpdate:modelValue":a[6]||(a[6]=e=>l.ruleForm.alarm_interval_s=e),min:1,max:60},null,8,["modelValue"]),p(T,{class:"box-item",effect:"dark",content:"报警后如果未恢复正常，间隔多久重新触发一次告警（最低60s）",placement:"bottom-start"},{default:_((()=>[p(U,{style:{"margin-left":"20px"}},{default:_((()=>[p(D)])),_:1})])),_:1})])),_:1}),p(R,{label:"是否使用",prop:"is_enable"},{default:_((()=>[p(E,{modelValue:l.ruleForm.is_enable,"onUpdate:modelValue":a[7]||(a[7]=e=>l.ruleForm.is_enable=e)},{default:_((()=>[p(q,{label:1},{default:_((()=>[c("使用")])),_:1}),p(q,{label:0},{default:_((()=>[c("禁用")])),_:1})])),_:1},8,["modelValue"])])),_:1}),p(R,{label:"配置说明",prop:"note"},{default:_((()=>[p(k,{modelValue:l.ruleForm.note,"onUpdate:modelValue":a[8]||(a[8]=e=>l.ruleForm.note=e)},null,8,["modelValue"])])),_:1}),p(R,{label:"发送时间段",required:""},{default:_((()=>[p(R,{prop:"startHour"},{default:_((()=>[p(O,{"value-format":"HH:mm:ss",modelValue:l.ruleForm.startHour,"onUpdate:modelValue":a[9]||(a[9]=e=>l.ruleForm.startHour=e),placeholder:"发送开始时间",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),C,p(R,{prop:"endHour"},{default:_((()=>[p(O,{"value-format":"HH:mm:ss",modelValue:l.ruleForm.endHour,"onUpdate:modelValue":a[10]||(a[10]=e=>l.ruleForm.endHour=e),placeholder:"发送结束时间",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),p(R,{label:"告警方式",prop:"alertType"},{default:_((()=>[p(G,{modelValue:l.ruleForm.alertType,"onUpdate:modelValue":a[11]||(a[11]=e=>l.ruleForm.alertType=e)},{default:_((()=>[p(A,{label:1},{default:_((()=>[c("钉钉")])),_:1})])),_:1},8,["modelValue"])])),_:1}),p(R,null,{default:_((()=>[p(n,{type:"primary",onClick:a[12]||(a[12]=e=>l.submitForm(l.ruleFormRef))},{default:_((()=>[c(g(l.ruleForm.id&&0!=l.ruleForm.id?"修改":"添加"),1)])),_:1}),p(n,{onClick:a[13]||(a[13]=e=>l.resetForm(l.ruleFormRef))},{default:_((()=>[c("重置")])),_:1})])),_:1})])),_:1},8,["model","rules"])])])),_:1},8,["modelValue","before-close"])])}]]);export{j as default};
