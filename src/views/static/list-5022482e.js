import{P as e,p as a}from"./index-58918b9d.js";import{E as t}from"./index-5d934b85.js";import{c as l,_ as r,r as n,o,a as i,k as d,F as p,b as s,d as u,l as c,i as f,y as m,z as h,e as g,M as b,N as y,R as v,a8 as T,a9 as _,aa as x,ab as P,ac as F,ad as w,Q as S,ae as C,S as k}from"./index-0620645c.js";import{t as D}from"./index-2094dd5b.js";import{u as N}from"./usePagination-b3cc9213.js";import"./service-9bc33229.js";const j={components:{Echarts:t},props:{options:{type:Object,required:!0}},name:"wxPerfEchart",setup:e=>({ntFormat:a=>{let t=null==e?void 0:e.options;if(!t||!Object.keys(t).length)return 0;let l=t.NT[a]||0;const r=t.FP||{},n=t.FCP||{},o=t.LCP||{},i=t.NT||{};return"FCP"==a&&n.startTime&&(l=n.startTime-i.appLaunchStartTime),"FP"==a&&Object.keys(r).length&&(l=r.startTime-i.appLaunchStartTime),"LCP"==a&&o.startTime&&(l=o.startTime-i.appLaunchStartTime),Number((l||0).toFixed(2))},navigationEchart:l((()=>{var a;const t=(null==(a=e.options)?void 0:a.NT)||{};if(!t||!Object.keys(t).length)return{};const l=["firstRender","script","route","appLaunch","loadPackage"],r=[],n=[];l.forEach(((e,a)=>{const o=(t[e]||0).toFixed(2);n.push(`${o}ms`);const i={name:e,type:"bar",stack:"Total",label:{show:!0,position:"right"},data:[]};for(let t=0,r=l.length;t<r;t++)a==t?i.data.push(o):i.data.push("-");r.push(i)}));const{script:o=0,route:i=0,loadPackage:d=0,appLaunch:p=0}=t;return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){for(let a=1,t=e.length;a<t;a++){let{name:t,value:l,seriesName:r,color:n}=e[a];if("-"!==l)return`${t}</br><span style="display:flex; align-items: center;">\n\t\t\t\t\t<i style="display:block;margin-right:5px;border-radius:50%;width:10px;height:10px;left:5px;background-color:${n}"></i>${r}:\n\t\t\t\t\t<i style="padding-left: 30px;">${l}</i>\n\t\t\t\t</span>`}}},xAxis:{type:"value",show:!1,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}}},yAxis:[{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:["页面渲染","JS注入","路由","小程序启动","代码包下载"]},{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:n}],seriesColorReset:!1,series:[{name:"Placeholder",type:"bar",stack:"Total",silent:!0,itemStyle:{borderColor:"transparent",color:"transparent"},emphasis:{itemStyle:{borderColor:"transparent",color:"transparent"}},data:[`${p+d+i+o}`,`${p+d+i}`,`${p+d}`,`${d}`]},...r]}}))})},L=s("div",{class:"flex flex-row justify-between",style:{width:"100%"}},null,-1);const R=r(j,[["render",function(e,a,t,l,r,s){const u=n("Echarts");return o(),i(p,null,[L,d(u,{options:l.navigationEchart},null,8,["options"])],64)}]]);const E=r({props:{data:{type:Array,defualt:()=>[]}},setup:e=>({NFTable:l((()=>{const a=["startTime","responseEnd","duration","dns","tcp","ssl","ttfb","contentDownload"];if(!e.data||!e.data.length)return[];return e.data.map((e=>{for(let t in e)a.includes(t)&&(e[t]=(e[t]||0).toFixed(2)+"ms");return e}))}))})},[["render",function(e,a,t,l,r,i){const p=n("el-table-column"),s=n("el-table");return o(),u(s,{data:l.NFTable,stripe:"","max-height":"500"},{default:c((()=>[d(p,{prop:"name",label:"资源名称",fixed:"",width:"200"}),d(p,{prop:"transferSize",label:"资源大小",fixed:""}),d(p,{prop:"initiatorType",label:"资源类型"}),d(p,{prop:"startTime",label:"开始时间"}),d(p,{prop:"responseEnd",label:"结束时间"}),d(p,{prop:"duration",label:"资源的总耗时"}),d(p,{prop:"dns",label:"DNS"}),d(p,{prop:"tcp",label:"TCP"}),d(p,{prop:"ssl",label:"SSL"}),d(p,{prop:"ttfb",label:"请求耗时"}),d(p,{prop:"contentDownload",label:"资源下载时间"}),d(p,{prop:"renderBlockingStatus",label:"否有渲染阻塞",fixed:"right"}),d(p,{prop:"isCache",label:"命中缓存",fixed:"right"})])),_:1},8,["data"])}]]);const z={components:{PerfEchart:e,WxPerfEchart:R,WxPerfResTable:r({props:{data:{type:Array,defualt:()=>[]}},setup(e){function a(e){const a=new Date(e);return`${a.getFullYear()}-${("0"+(a.getMonth()+1)).slice(-2)}-${("0"+a.getDate()).slice(-2)} ${("0"+a.getHours()).slice(-2)}:${("0"+a.getMinutes()).slice(-2)}:${("0"+a.getSeconds()).slice(-2)}`}return{NFTable:l((()=>{if(!e.data||!e.data.length)return[];return e.data.map((e=>(e.startTime=a(parseInt(e.startTime)),e.domainLookupStart=a(parseInt(e.domainLookupStart)),e.domainLookupEnd=a(parseInt(e.domainLookupEnd)),e)))}))}}},[["render",function(e,a,t,l,r,i){const p=n("el-table-column"),s=n("el-table");return o(),u(s,{data:l.NFTable,stripe:"","max-height":"500"},{default:c((()=>[d(p,{prop:"name",label:"资源名称",fixed:"",width:"200"}),d(p,{prop:"transferSize",label:"资源大小",fixed:""}),d(p,{prop:"initiatorType",label:"资源类型"}),d(p,{prop:"startTime",label:"开始时间"}),d(p,{prop:"domainLookupStart",label:"DNS查询开始"}),d(p,{prop:"domainLookupEnd",label:"DNS查询结束"}),d(p,{prop:"duration",label:"资源的总耗时"})])),_:1},8,["data"])}]]),PerfResTable:E},props:{perfNode:{type:Object,required:!0},project:{type:Object,required:!0}},name:"perfDetail",setup(e){const{perfNode:a}=e;return{drawerVisible:f(!0),perfEchartOPtion:l((()=>({NT:(null==a?void 0:a.nt)||{},FP:(null==a?void 0:a.fp)||{},FCP:(null==a?void 0:a.fcp)||{},LCP:(null==a?void 0:a.lcp)||{}})))}}},$=e=>(b("data-v-fc0d4c0b"),e=e(),y(),e),U={class:"detail-wapper flex-1"},I={class:"detail-top-content"},O={class:"flex basic-info"},V={class:"other-basic"},A={class:"detail-bottom-content flex flex-1"},M={class:"navigation-content"},B=$((()=>s("h2",{class:"title"},"会话性能指标",-1))),W={class:"flex navigation-target"},q=$((()=>s("p",null,null,-1))),H=$((()=>s("p",null,null,-1))),J=$((()=>s("p",null,null,-1))),Q=$((()=>s("p",null,null,-1))),Y=$((()=>s("p",null,null,-1))),G=$((()=>s("p",null,null,-1))),K=$((()=>s("p",null,null,-1))),X=$((()=>s("p",null,null,-1))),Z=$((()=>s("h2",{class:"title"},"页面加载瀑布图",-1))),ee=$((()=>s("h2",{class:"title"},"会话性能指标",-1))),ae=$((()=>s("h3",{class:"title"},"FP 白屏资源",-1))),te=$((()=>s("h3",{class:"title"},"FCP 灰屏资源",-1))),le=$((()=>s("h3",{class:"title"},"RF 资源",-1)));const re={class:"app-container"},ne={class:"table-wrapper"},oe={class:"pager-wrapper"};const ie=r({name:"Performance",components:{PerfDetail:r(z,[["render",function(e,a,t,l,r,f){const b=n("Edit"),y=n("el-icon"),v=n("Clock"),T=n("Location"),_=n("Document"),x=n("Postcard"),P=n("FolderRemove"),F=n("el-tooltip"),w=n("PerfEchart"),S=n("WxPerfEchart"),C=n("PerfResTable"),k=n("WxPerfResTable"),D=n("el-scroll"),N=n("el-drawer");return o(),u(N,{modelValue:l.drawerVisible,"onUpdate:modelValue":a[0]||(a[0]=e=>l.drawerVisible=e),ref:"drawerRef",title:"性能指标查看",direction:"rtl",size:"95%","z-index":9999,"append-to-body":!0},{default:c((()=>{var e,a,r,n,f,N,j;return[s("section",U,[s("div",I,[s("dl",O,[s("dd",null,[d(y,{size:15},{default:c((()=>[d(b)])),_:1}),m(h(null==(e=t.perfNode)?void 0:e.uuId),1)]),s("dd",null,[d(y,{size:15},{default:c((()=>[d(v)])),_:1}),m(h(null==(a=t.perfNode)?void 0:a.happenTime),1)]),s("dd",null,[d(y,null,{default:c((()=>[d(T)])),_:1}),m(h(null==(r=t.perfNode)?void 0:r.country),1)]),s("dd",null,[d(y,null,{default:c((()=>[d(_)])),_:1}),m(h(null==(n=t.perfNode)?void 0:n.browserInfo),1)]),s("dd",null,[d(y,null,{default:c((()=>[d(x)])),_:1}),m(h(null==(f=t.perfNode)?void 0:f.os),1)]),s("dd",null,[d(y,null,{default:c((()=>[d(P)])),_:1}),m(h(null==(N=t.perfNode)?void 0:N.device),1)])]),s("div",V,h(null==(j=t.perfNode)?void 0:j.pageUrl),1)]),s("div",A,[d(D,{ref:"scrollbarRef",trigger:"hover",class:"flex-1",direction:"all"},{default:c((()=>{var e,a,r,n,f,h,b,y;return[s("div",M,[B,s("dl",W,[s("dd",null,[m(" CLS"),d(F,{content:" --",placement:"top"},{default:c((()=>[q])),_:1})]),s("dd",null,[m(" FCP"),d(F,{content:" --",placement:"top"},{default:c((()=>[H])),_:1})]),s("dd",null,[m(" FID"),d(F,{content:" --",placement:"top"},{default:c((()=>[J])),_:1})]),s("dd",null,[m(" FMP"),d(F,{content:" --",placement:"top"},{default:c((()=>[Q])),_:1})]),s("dd",null,[m(" FP"),d(F,{content:" --",placement:"top"},{default:c((()=>[Y])),_:1})]),s("dd",null,[m(" LCP"),d(F,{content:" --",placement:"top"},{default:c((()=>[G])),_:1})]),s("dd",null,[m(" MPFID"),d(F,{content:" --",placement:"top"},{default:c((()=>[K])),_:1})]),s("dd",null,[m(" TTI"),d(F,{content:" --",placement:"top"},{default:c((()=>[X])),_:1})])]),Z,s("div",null,[1==t.project.projectType?(o(),u(w,{key:0,options:l.perfEchartOPtion},null,8,["options"])):g("",!0),2==t.project.projectType?(o(),u(S,{key:1,options:l.perfEchartOPtion},null,8,["options"])):g("",!0)]),ee,s("div",null,[(null==(e=t.perfNode)?void 0:e.fp)&&1==t.project.projectType?(o(),i(p,{key:0},[ae,d(C,{data:null==(r=null==(a=t.perfNode)?void 0:a.fp)?void 0:r.RF},null,8,["data"])],64)):g("",!0),(null==(n=t.perfNode)?void 0:n.fcp)&&1==t.project.projectType?(o(),i(p,{key:1},[te,d(C,{data:null==(h=null==(f=t.perfNode)?void 0:f.fcp)?void 0:h.RF},null,8,["data"])],64)):g("",!0),le,1==t.project.projectType?(o(),u(C,{key:2,data:null==(b=t.perfNode)?void 0:b.rf},null,8,["data"])):g("",!0),2==t.project.projectType?(o(),u(k,{key:3,data:null==(y=t.perfNode)?void 0:y.rf},null,8,["data"])):g("",!0)])])]})),_:1},512)])])]})),_:1},8,["modelValue"])}],["__scopeId","data-v-fc0d4c0b"]])},setup(){const e=f(!1),t=f({pageUrl:"",data:D({format:["00:00:00","23:59:59"]})}),l=f({}),r=f([]),n=f({}),{paginationData:o,handleCurrentChange:i,handleSizeChange:d}=N((()=>{p()}));v((()=>{p()}));const p=async()=>{let e={pageUrl:t.value.pageUrl,startTime:t.value.data[0],endTime:t.value.data[1],page:o.currentPage,pageSize:o.pageSize},l=await a(e);l.success&&(o.total=l.model.count,r.value=l.model.list,n.value=l.model.project)};return{loading:e,searchData:t,resetSearch:()=>{t.value={pageUrl:"",data:D({format:["00:00:00","23:59:59"]})},o.currentPage=1,p()},handleSearch:p,Search:T,Refresh:_,CirclePlus:x,RefreshRight:P,Delete:F,Download:w,tableData:r,paginationData:o,handleCurrentChange:i,handleSizeChange:d,ntFormat:(e,a)=>{let t=e.nt&&e.nt[a]||0;const l=e.fp,r=e.fpc;return"fp"==a&&l&&(t=l.startTime),"fpc"==a&&r&&(t=r.startTime),e.nt||t?t.toFixed(2)+"ms":"-"},handleDetail:e=>{l.value={},S((()=>l.value=e))},perfNode:l,project:n}}},[["render",function(e,a,t,l,r,f){const b=n("el-input"),y=n("el-form-item"),v=n("el-date-picker"),T=n("el-button"),_=n("el-form"),x=n("el-card"),P=n("el-table-column"),F=n("Histogram"),w=n("el-icon"),S=n("el-table"),D=n("el-pagination"),N=n("PerfDetail"),j=C("loading");return o(),i(p,null,[s("div",re,[k((o(),u(x,{shadow:"never",class:"search-wrapper"},{default:c((()=>[d(_,{ref:"searchFormRef",inline:!0,model:l.searchData},{default:c((()=>[d(y,{prop:"pageUrl",label:"页面链接"},{default:c((()=>[d(b,{modelValue:l.searchData.pageUrl,"onUpdate:modelValue":a[0]||(a[0]=e=>l.searchData.pageUrl=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1}),d(y,{prop:"phone",label:"日期"},{default:c((()=>[d(v,{modelValue:l.searchData.data,"onUpdate:modelValue":a[1]||(a[1]=e=>l.searchData.data=e),type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])])),_:1}),d(y,null,{default:c((()=>[d(T,{type:"primary",onClick:l.handleSearch},{default:c((()=>[m("查询")])),_:1},8,["onClick"]),d(T,{onClick:l.resetSearch},{default:c((()=>[m("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1})),[[j,l.loading]]),k((o(),u(x,{shadow:"never"},{default:c((()=>[s("div",ne,[1==l.project.projectType?(o(),u(S,{key:0,border:"",data:l.tableData},{default:c((()=>[d(P,{prop:"monitorAppId",label:"项目ID",align:"center"}),d(P,{prop:"pageUrl",label:"url",align:"center"}),d(P,{label:"会话性能指标",align:"center"},{default:c((()=>[d(P,{label:"Navigation 指标",align:"center"},{default:c((()=>[d(P,{label:"DNS 查询"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"DNS")),1)])),_:1}),d(P,{label:"TCP 链接"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"TCP")),1)])),_:1}),d(P,{label:"SSL 建连"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"SSL")),1)])),_:1}),d(P,{label:"TTFB 请求响应"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"TTFB")),1)])),_:1}),d(P,{label:"TRANS 内容传输"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"Trans")),1)])),_:1}),d(P,{label:"DOM 解析"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"DomParse")),1)])),_:1}),d(P,{label:"RES 资源加载"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"Res")),1)])),_:1})])),_:1}),d(P,{label:"性能关键指标",align:"center"},{default:c((()=>[d(P,{label:"白屏时间"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"FP")),1)])),_:1}),d(P,{label:"FCP 灰屏时间"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"FPC")),1)])),_:1}),d(P,{label:"FirseByte 首字节"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"FirseByte")),1)])),_:1}),d(P,{label:"DOMReady"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"DomReady")),1)])),_:1}),d(P,{label:"LOAD 加载完成"},{default:c((({row:e})=>[m(h(l.ntFormat(e,"Load")),1)])),_:1})])),_:1})])),_:1}),d(P,{label:"性能图表",fixed:"right",align:"center"},{default:c((({row:e})=>[d(T,{type:"text",onClick:a=>l.handleDetail(e)},{default:c((()=>[d(w,{style:{"vertical-align":"middle"}},{default:c((()=>[d(F)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):g("",!0),2==l.project.projectType?(o(),u(S,{key:1,border:"",data:l.tableData},{default:c((()=>[d(P,{prop:"nt.appLaunch",label:"小程序启动耗时",align:"center"}),d(P,{prop:"nt.route",label:"路由耗时",align:"center"}),d(P,{prop:"nt.firstRender",label:"页面渲染",align:"center"}),d(P,{prop:"nt.script",label:"js注入耗时",align:"center"}),d(P,{prop:"nt.loadPackage",label:"代码包下载耗时",align:"center"}),d(P,{label:"性能图表",fixed:"right",align:"center"},{default:c((({row:e})=>[d(T,{type:"text",onClick:a=>l.handleDetail(e)},{default:c((()=>[d(w,{style:{"vertical-align":"middle"}},{default:c((()=>[d(F)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):g("",!0)]),s("div",oe,[d(D,{background:"",layout:l.paginationData.layout,"page-sizes":l.paginationData.pageSizes,total:l.paginationData.total,"page-size":l.paginationData.pageSize,currentPage:l.paginationData.currentPage,onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1})),[[j,l.loading]])]),l.perfNode.simpleUrl?(o(),u(N,{key:0,project:l.project,perfNode:l.perfNode},null,8,["project","perfNode"])):g("",!0)],64)}],["__scopeId","data-v-4b1b86b5"]]);export{ie as default};
