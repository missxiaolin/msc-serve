import{P as e,p as a}from"./index-ba8baebb.js";import{c as t,_ as l,r as n,o as i,d as r,l as o,k as d,i as p,b as s,a as u,y as c,z as f,e as g,M as m,N as b,R as h,a8 as v,a9 as x,aa as _,ab as y,ac as D,ad as V,Q as w,ae as C,S as N,F as S}from"./index-f7b62236.js";import{t as k}from"./index-2685af30.js";import{u as P}from"./usePagination-d5a8cdf5.js";import"./index-e17dbb2e.js";import"./service-390d662b.js";const T=l({props:{data:{type:Array,defualt:()=>[]}},setup:e=>({NFTable:t((()=>{const a=["startTime","responseEnd","duration","dns","tcp","ssl","ttfb","contentDownload"];if(!e.data||!e.data.length)return[];return e.data.map((e=>{for(let t in e)a.includes(t)&&(e[t]=(e[t]||0).toFixed(2)+"ms");return e}))}))})},[["render",function(e,a,t,l,p,s){const u=n("el-table-column"),c=n("el-table");return i(),r(c,{data:l.NFTable,stripe:"","max-height":"500"},{default:o((()=>[d(u,{prop:"name",label:"资源名称",fixed:"",width:"200"}),d(u,{prop:"transferSize",label:"资源大小",fixed:""}),d(u,{prop:"initiatorType",label:"资源类型"}),d(u,{prop:"startTime",label:"开始时间"}),d(u,{prop:"responseEnd",label:"结束时间"}),d(u,{prop:"duration",label:"资源的总耗时"}),d(u,{prop:"dns",label:"DNS"}),d(u,{prop:"tcp",label:"TCP"}),d(u,{prop:"ssl",label:"SSL"}),d(u,{prop:"ttfb",label:"请求耗时"}),d(u,{prop:"contentDownload",label:"资源下载时间"}),d(u,{prop:"renderBlockingStatus",label:"否有渲染阻塞",fixed:"right"}),d(u,{prop:"isCache",label:"命中缓存",fixed:"right"})])),_:1},8,["data"])}]]);const j={components:{PerfEchart:e,WxPerfResTable:l({props:{data:{type:Array,defualt:()=>[]}},setup(e){function a(e){const a=new Date(e);return`${a.getFullYear()}-${("0"+(a.getMonth()+1)).slice(-2)}-${("0"+a.getDate()).slice(-2)} ${("0"+a.getHours()).slice(-2)}:${("0"+a.getMinutes()).slice(-2)}:${("0"+a.getSeconds()).slice(-2)}`}return{NFTable:t((()=>{if(!e.data||!e.data.length)return[];return e.data.map((e=>(e.startTime=a(parseInt(e.startTime)),e.domainLookupStart=a(parseInt(e.domainLookupStart)),e.domainLookupEnd=a(parseInt(e.domainLookupEnd)),e)))}))}}},[["render",function(e,a,t,l,p,s){const u=n("el-table-column"),c=n("el-table");return i(),r(c,{data:l.NFTable,stripe:"","max-height":"500"},{default:o((()=>[d(u,{prop:"name",label:"资源名称",fixed:"",width:"200"}),d(u,{prop:"transferSize",label:"资源大小",fixed:""}),d(u,{prop:"initiatorType",label:"资源类型"}),d(u,{prop:"startTime",label:"开始时间"}),d(u,{prop:"domainLookupStart",label:"DNS查询开始"}),d(u,{prop:"domainLookupEnd",label:"DNS查询结束"}),d(u,{prop:"duration",label:"资源的总耗时"})])),_:1},8,["data"])}]]),PerfResTable:T},props:{perfNode:{type:Object,required:!0},project:{type:Object,required:!0}},name:"perfDetail",setup(e){const{perfNode:a}=e;return{drawerVisible:p(!0),perfEchartOPtion:t((()=>({nt:(a["navigation-timing"]||{}).textValue,fp:a["first-paint"]||{}})))}}},z=e=>(m("data-v-1a43fd06"),e=e(),b(),e),L={class:"detail-wapper flex-1"},R={class:"detail-top-content"},F={class:"flex basic-info"},U={key:0},E={class:"other-basic"},I={class:"detail-bottom-content flex flex-1"},O={class:"navigation-content"},$=z((()=>s("h2",{class:"title"},"会话性能指标",-1))),M={class:"flex navigation-target"},A=z((()=>s("h2",{class:"title"},"页面加载瀑布图",-1))),q=z((()=>s("h2",{class:"title"},"会话性能指标",-1))),B=z((()=>s("h3",{class:"title"},"RF 资源",-1)));const H={class:"app-container"},W={class:"table-wrapper"},Q={class:"pager-wrapper"};const Y=l({name:"Performance",components:{PerfDetail:l(j,[["render",function(e,a,t,l,p,m){const b=n("Edit"),h=n("el-icon"),v=n("Clock"),x=n("PerfEchart"),_=n("PerfResTable"),y=n("WxPerfResTable"),D=n("el-scroll"),V=n("el-drawer");return i(),r(V,{modelValue:l.drawerVisible,"onUpdate:modelValue":a[0]||(a[0]=e=>l.drawerVisible=e),ref:"drawerRef",title:"性能指标查看",direction:"rtl",size:"95%","z-index":9999,"append-to-body":!0},{default:o((()=>{var e,a,n,p;return[s("section",L,[s("div",R,[s("dl",F,[(null==(e=t.perfNode)?void 0:e.uuId)?(i(),u("dd",U,[d(h,{size:15},{default:o((()=>[d(b)])),_:1}),c(f(null==(a=t.perfNode)?void 0:a.uuId),1)])):g("",!0),s("dd",null,[d(h,{size:15},{default:o((()=>[d(v)])),_:1}),c(f(null==(n=t.perfNode)?void 0:n.happenTime),1)])]),s("div",E,f(null==(p=t.perfNode)?void 0:p.simpleUrl),1)]),s("div",I,[d(D,{ref:"scrollbarRef",trigger:"hover",class:"flex-1",direction:"all"},{default:o((()=>{var e;return[s("div",O,[$,s("dl",M,[s("dd",null," CLS："+f(t.perfNode["cumulative-layout-shift"]&&t.perfNode["cumulative-layout-shift"].numValue||0)+" ms ",1),s("dd",null," FCP："+f(t.perfNode["first-contentful-paint"]&&t.perfNode["first-contentful-paint"].numValue||0)+" ms ",1),s("dd",null," FID："+f(t.perfNode["first-input-delay"]&&t.perfNode["first-input-delay"].textValue.delay||0)+" ms ",1),s("dd",null," FP："+f(t.perfNode["first-paint"]&&t.perfNode["first-paint"].numValue||0)+" ms ",1),s("dd",null," LCP："+f(t.perfNode["largest-contentful-paint"]&&t.perfNode["largest-contentful-paint"].numValue||0)+" ms ",1)]),A,s("div",null,[1==t.project.projectType?(i(),r(x,{key:0,options:l.perfEchartOPtion},null,8,["options"])):g("",!0)]),q,s("div",null,[B,1==t.project.projectType?(i(),r(_,{key:0,data:t.perfNode["resource-flow"]},null,8,["data"])):g("",!0),2==t.project.projectType?(i(),r(y,{key:1,data:null==(e=t.perfNode)?void 0:e.rf},null,8,["data"])):g("",!0)])])]})),_:1},512)])])]})),_:1},8,["modelValue"])}],["__scopeId","data-v-1a43fd06"]])},setup(){const e=p(!1),t=p({simpleUrl:"",data:k({format:["00:00:00","23:59:59"]})}),l=p({}),n=p([]),i=p({}),{paginationData:r,handleCurrentChange:o,handleSizeChange:d}=P((()=>{s()}));h((()=>{s()}));const s=async()=>{let e={simpleUrl:t.value.simpleUrl,startTime:t.value.data[0],endTime:t.value.data[1],page:r.currentPage,pageSize:r.pageSize},l=await a(e);l.success&&(r.total=l.model.count,n.value=l.model.list,i.value=l.model.project)};return{loading:e,searchData:t,resetSearch:()=>{t.value={simpleUrl:"",data:k({format:["00:00:00","23:59:59"]})},r.currentPage=1,s()},handleSearch:s,Search:v,Refresh:x,CirclePlus:_,RefreshRight:y,Delete:D,Download:V,tableData:n,paginationData:r,handleCurrentChange:o,handleSizeChange:d,handleDetail:e=>{l.value={},w((()=>l.value=e))},perfNode:l,project:i}}},[["render",function(e,a,t,l,p,m){const b=n("el-input"),h=n("el-form-item"),v=n("el-date-picker"),x=n("el-button"),_=n("el-form"),y=n("el-card"),D=n("el-table-column"),V=n("Histogram"),w=n("el-icon"),k=n("el-table"),P=n("el-pagination"),T=n("PerfDetail"),j=C("loading");return i(),u(S,null,[s("div",H,[N((i(),r(y,{shadow:"never",class:"search-wrapper"},{default:o((()=>[d(_,{ref:"searchFormRef",inline:!0,model:l.searchData},{default:o((()=>[d(h,{prop:"simpleUrl",label:"页面链接"},{default:o((()=>[d(b,{modelValue:l.searchData.simpleUrl,"onUpdate:modelValue":a[0]||(a[0]=e=>l.searchData.simpleUrl=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1}),d(h,{prop:"phone",label:"日期"},{default:o((()=>[d(v,{modelValue:l.searchData.data,"onUpdate:modelValue":a[1]||(a[1]=e=>l.searchData.data=e),type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])])),_:1}),d(h,null,{default:o((()=>[d(x,{type:"primary",onClick:l.handleSearch},{default:o((()=>[c("查询")])),_:1},8,["onClick"]),d(x,{onClick:l.resetSearch},{default:o((()=>[c("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1})),[[j,l.loading]]),N((i(),r(y,{shadow:"never"},{default:o((()=>[s("div",W,[1==l.project.projectType?(i(),r(k,{key:0,border:"",data:l.tableData},{default:o((()=>[d(D,{prop:"simpleUrl",label:"url",align:"center"}),d(D,{label:"会话性能指标",align:"center"},{default:o((()=>[d(D,{label:"Navigation 指标",align:"center"},{default:o((()=>[d(D,{label:"DNS 查询"},{default:o((({row:e})=>[c(f(e["navigation-timing"]&&e["navigation-timing"].textValue.dnsLookup?e["navigation-timing"].textValue.dnsLookup:0),1)])),_:1}),d(D,{label:"TCP 链接"},{default:o((({row:e})=>[c(f(e["navigation-timing"]&&e["navigation-timing"].textValue.initialConnection?e["navigation-timing"].textValue.initialConnection:0),1)])),_:1}),d(D,{label:"SSL 建连"},{default:o((({row:e})=>[c(f(e["navigation-timing"]&&e["navigation-timing"].textValue.ssl?e["navigation-timing"].textValue.ssl:0),1)])),_:1}),d(D,{label:"TTFB 请求响应"},{default:o((({row:e})=>[c(f(e["navigation-timing"]&&e["navigation-timing"].textValue.ttfb?e["navigation-timing"].textValue.ttfb:0),1)])),_:1}),d(D,{label:"TRANS 内容传输"},{default:o((({row:e})=>[c(f(e["navigation-timing"]&&e["navigation-timing"].textValue.contentDownload?e["navigation-timing"].textValue.contentDownload:0),1)])),_:1}),d(D,{label:"DOM 解析"},{default:o((({row:e})=>[c(f(e["navigation-timing"]&&e["navigation-timing"].textValue.domParse?e["navigation-timing"].textValue.domParse:0),1)])),_:1}),d(D,{label:"RES 资源加载"},{default:o((({row:e})=>[c(f(e["navigation-timing"]&&e["navigation-timing"].textValue.resourceLoad?e["navigation-timing"].textValue.resourceLoad:0),1)])),_:1})])),_:1}),d(D,{label:"性能关键指标",align:"center"},{default:o((()=>[d(D,{label:"白屏时间"},{default:o((({row:e})=>[c(f(e["first-paint"]&&e["first-paint"].value?e["first-paint"].value:"-"),1)])),_:1}),d(D,{label:"FCP 灰屏时间"},{default:o((({row:e})=>[c(f(e["first-contentful-paint"]&&e["first-contentful-paint"].value?e["first-contentful-paint"].value:"-"),1)])),_:1}),d(D,{label:"DOM完成加载"},{default:o((({row:e})=>[c(f(e["navigation-timing"]&&e["navigation-timing"].textValue.domReady?e["navigation-timing"].textValue.domReady:0),1)])),_:1}),d(D,{label:"页面完全加载"},{default:o((({row:e})=>[c(f(e["navigation-timing"]&&e["navigation-timing"].textValue.pageLoad?e["navigation-timing"].textValue.pageLoad:0),1)])),_:1})])),_:1})])),_:1}),d(D,{label:"性能图表",fixed:"right",align:"center"},{default:o((({row:e})=>[d(x,{type:"text",onClick:a=>l.handleDetail(e)},{default:o((()=>[d(w,{style:{"vertical-align":"middle"}},{default:o((()=>[d(V)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):g("",!0),2==l.project.projectType?(i(),r(k,{key:1,border:"",data:l.tableData},{default:o((()=>[d(D,{prop:"pageUrl",label:"url",align:"center"}),d(D,{prop:"nt.appLaunch",label:"小程序启动耗时",align:"center"}),d(D,{prop:"nt.route",label:"路由耗时",align:"center"}),d(D,{prop:"nt.firstRender",label:"页面渲染",align:"center"}),d(D,{prop:"nt.script",label:"js注入耗时",align:"center"}),d(D,{prop:"nt.loadPackage",label:"代码包下载耗时",align:"center"}),d(D,{label:"性能图表",fixed:"right",align:"center"},{default:o((({row:e})=>[d(x,{type:"text",onClick:a=>l.handleDetail(e)},{default:o((()=>[d(w,{style:{"vertical-align":"middle"}},{default:o((()=>[d(V)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):g("",!0)]),s("div",Q,[d(P,{background:"",layout:l.paginationData.layout,"page-sizes":l.paginationData.pageSizes,total:l.paginationData.total,"page-size":l.paginationData.pageSize,currentPage:l.paginationData.currentPage,onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1})),[[j,l.loading]])]),l.perfNode.simpleUrl?(i(),r(T,{key:0,project:l.project,perfNode:l.perfNode},null,8,["project","perfNode"])):g("",!0)],64)}],["__scopeId","data-v-e72e314f"]]);export{Y as default};
