import{P as e,W as a,p as l}from"./index-fc2914f7.js";import{c as t,_ as n,r,o,d,l as p,k as i,i as u,b as s,y as c,z as f,e as m,a as b,F as g,M as h,N as _,R as v,a8 as y,a9 as D,aa as F,ab as P,ac as T,ad as C,Q as S,ae as w,S as N}from"./index-ec675762.js";import{t as j}from"./index-12761950.js";import{u as k}from"./usePagination-cbf3122f.js";import"./index-7e38eb64.js";import"./service-712b9305.js";const x=n({props:{data:{type:Array,defualt:()=>[]}},setup:e=>({NFTable:t((()=>{const a=["startTime","responseEnd","duration","dns","tcp","ssl","ttfb","contentDownload"];if(!e.data||!e.data.length)return[];return e.data.map((e=>{for(let l in e)a.includes(l)&&(e[l]=(e[l]||0).toFixed(2)+"ms");return e}))}))})},[["render",function(e,a,l,t,n,u){const s=r("el-table-column"),c=r("el-table");return o(),d(c,{data:t.NFTable,stripe:"","max-height":"500"},{default:p((()=>[i(s,{prop:"name",label:"资源名称",fixed:"",width:"200"}),i(s,{prop:"transferSize",label:"资源大小",fixed:""}),i(s,{prop:"initiatorType",label:"资源类型"}),i(s,{prop:"startTime",label:"开始时间"}),i(s,{prop:"responseEnd",label:"结束时间"}),i(s,{prop:"duration",label:"资源的总耗时"}),i(s,{prop:"dns",label:"DNS"}),i(s,{prop:"tcp",label:"TCP"}),i(s,{prop:"ssl",label:"SSL"}),i(s,{prop:"ttfb",label:"请求耗时"}),i(s,{prop:"contentDownload",label:"资源下载时间"}),i(s,{prop:"renderBlockingStatus",label:"否有渲染阻塞",fixed:"right"}),i(s,{prop:"isCache",label:"命中缓存",fixed:"right"})])),_:1},8,["data"])}]]);const R={components:{PerfEchart:e,WxPerfEchart:a,WxPerfResTable:n({props:{data:{type:Array,defualt:()=>[]}},setup(e){function a(e){const a=new Date(e);return`${a.getFullYear()}-${("0"+(a.getMonth()+1)).slice(-2)}-${("0"+a.getDate()).slice(-2)} ${("0"+a.getHours()).slice(-2)}:${("0"+a.getMinutes()).slice(-2)}:${("0"+a.getSeconds()).slice(-2)}`}return{NFTable:t((()=>{if(!e.data||!e.data.length)return[];return e.data.map((e=>(e.startTime=a(parseInt(e.startTime)),e.domainLookupStart=a(parseInt(e.domainLookupStart)),e.domainLookupEnd=a(parseInt(e.domainLookupEnd)),e)))}))}}},[["render",function(e,a,l,t,n,u){const s=r("el-table-column"),c=r("el-table");return o(),d(c,{data:t.NFTable,stripe:"","max-height":"500"},{default:p((()=>[i(s,{prop:"name",label:"资源名称",fixed:"",width:"200"}),i(s,{prop:"transferSize",label:"资源大小",fixed:""}),i(s,{prop:"initiatorType",label:"资源类型"}),i(s,{prop:"startTime",label:"开始时间"}),i(s,{prop:"domainLookupStart",label:"DNS查询开始"}),i(s,{prop:"domainLookupEnd",label:"DNS查询结束"}),i(s,{prop:"duration",label:"资源的总耗时"})])),_:1},8,["data"])}]]),PerfResTable:x},props:{perfNode:{type:Object,required:!0},project:{type:Object,required:!0}},name:"perfDetail",setup(e){const{perfNode:a}=e;return{drawerVisible:u(!0),perfEchartOPtion:t((()=>({NT:(null==a?void 0:a.nt)||{},FP:(null==a?void 0:a.fp)||{},FCP:(null==a?void 0:a.fcp)||{},LCP:(null==a?void 0:a.lcp)||{}})))}}},z=e=>(h("data-v-fc0d4c0b"),e=e(),_(),e),L={class:"detail-wapper flex-1"},E={class:"detail-top-content"},U={class:"flex basic-info"},I={class:"other-basic"},V={class:"detail-bottom-content flex flex-1"},O={class:"navigation-content"},M=z((()=>s("h2",{class:"title"},"会话性能指标",-1))),$={class:"flex navigation-target"},A=z((()=>s("p",null,null,-1))),B=z((()=>s("p",null,null,-1))),W=z((()=>s("p",null,null,-1))),q=z((()=>s("p",null,null,-1))),H=z((()=>s("p",null,null,-1))),Q=z((()=>s("p",null,null,-1))),Y=z((()=>s("p",null,null,-1))),G=z((()=>s("p",null,null,-1))),J=z((()=>s("h2",{class:"title"},"页面加载瀑布图",-1))),K=z((()=>s("h2",{class:"title"},"会话性能指标",-1))),X=z((()=>s("h3",{class:"title"},"FP 白屏资源",-1))),Z=z((()=>s("h3",{class:"title"},"FCP 灰屏资源",-1))),ee=z((()=>s("h3",{class:"title"},"RF 资源",-1)));const ae={class:"app-container"},le={class:"table-wrapper"},te={class:"pager-wrapper"};const ne=n({name:"Performance",components:{PerfDetail:n(R,[["render",function(e,a,l,t,n,u){const h=r("Edit"),_=r("el-icon"),v=r("Clock"),y=r("Location"),D=r("Document"),F=r("Postcard"),P=r("FolderRemove"),T=r("el-tooltip"),C=r("PerfEchart"),S=r("WxPerfEchart"),w=r("PerfResTable"),N=r("WxPerfResTable"),j=r("el-scroll"),k=r("el-drawer");return o(),d(k,{modelValue:t.drawerVisible,"onUpdate:modelValue":a[0]||(a[0]=e=>t.drawerVisible=e),ref:"drawerRef",title:"性能指标查看",direction:"rtl",size:"95%","z-index":9999,"append-to-body":!0},{default:p((()=>{var e,a,n,r,u,k,x;return[s("section",L,[s("div",E,[s("dl",U,[s("dd",null,[i(_,{size:15},{default:p((()=>[i(h)])),_:1}),c(f(null==(e=l.perfNode)?void 0:e.uuId),1)]),s("dd",null,[i(_,{size:15},{default:p((()=>[i(v)])),_:1}),c(f(null==(a=l.perfNode)?void 0:a.happenTime),1)]),s("dd",null,[i(_,null,{default:p((()=>[i(y)])),_:1}),c(f(null==(n=l.perfNode)?void 0:n.country),1)]),s("dd",null,[i(_,null,{default:p((()=>[i(D)])),_:1}),c(f(null==(r=l.perfNode)?void 0:r.browserInfo),1)]),s("dd",null,[i(_,null,{default:p((()=>[i(F)])),_:1}),c(f(null==(u=l.perfNode)?void 0:u.os),1)]),s("dd",null,[i(_,null,{default:p((()=>[i(P)])),_:1}),c(f(null==(k=l.perfNode)?void 0:k.device),1)])]),s("div",I,f(null==(x=l.perfNode)?void 0:x.pageUrl),1)]),s("div",V,[i(j,{ref:"scrollbarRef",trigger:"hover",class:"flex-1",direction:"all"},{default:p((()=>{var e,a,n,r,u,f,h,_;return[s("div",O,[M,s("dl",$,[s("dd",null,[c(" CLS"),i(T,{content:" --",placement:"top"},{default:p((()=>[A])),_:1})]),s("dd",null,[c(" FCP"),i(T,{content:" --",placement:"top"},{default:p((()=>[B])),_:1})]),s("dd",null,[c(" FID"),i(T,{content:" --",placement:"top"},{default:p((()=>[W])),_:1})]),s("dd",null,[c(" FMP"),i(T,{content:" --",placement:"top"},{default:p((()=>[q])),_:1})]),s("dd",null,[c(" FP"),i(T,{content:" --",placement:"top"},{default:p((()=>[H])),_:1})]),s("dd",null,[c(" LCP"),i(T,{content:" --",placement:"top"},{default:p((()=>[Q])),_:1})]),s("dd",null,[c(" MPFID"),i(T,{content:" --",placement:"top"},{default:p((()=>[Y])),_:1})]),s("dd",null,[c(" TTI"),i(T,{content:" --",placement:"top"},{default:p((()=>[G])),_:1})])]),J,s("div",null,[1==l.project.projectType?(o(),d(C,{key:0,options:t.perfEchartOPtion},null,8,["options"])):m("",!0),2==l.project.projectType?(o(),d(S,{key:1,options:t.perfEchartOPtion},null,8,["options"])):m("",!0)]),K,s("div",null,[(null==(e=l.perfNode)?void 0:e.fp)&&1==l.project.projectType?(o(),b(g,{key:0},[X,i(w,{data:null==(n=null==(a=l.perfNode)?void 0:a.fp)?void 0:n.RF},null,8,["data"])],64)):m("",!0),(null==(r=l.perfNode)?void 0:r.fcp)&&1==l.project.projectType?(o(),b(g,{key:1},[Z,i(w,{data:null==(f=null==(u=l.perfNode)?void 0:u.fcp)?void 0:f.RF},null,8,["data"])],64)):m("",!0),ee,1==l.project.projectType?(o(),d(w,{key:2,data:null==(h=l.perfNode)?void 0:h.rf},null,8,["data"])):m("",!0),2==l.project.projectType?(o(),d(N,{key:3,data:null==(_=l.perfNode)?void 0:_.rf},null,8,["data"])):m("",!0)])])]})),_:1},512)])])]})),_:1},8,["modelValue"])}],["__scopeId","data-v-fc0d4c0b"]])},setup(){const e=u(!1),a=u({pageUrl:"",data:j({format:["00:00:00","23:59:59"]})}),t=u({}),n=u([]),r=u({}),{paginationData:o,handleCurrentChange:d,handleSizeChange:p}=k((()=>{i()}));v((()=>{i()}));const i=async()=>{let e={pageUrl:a.value.pageUrl,startTime:a.value.data[0],endTime:a.value.data[1],page:o.currentPage,pageSize:o.pageSize},t=await l(e);t.success&&(o.total=t.model.count,n.value=t.model.list,r.value=t.model.project)};return{loading:e,searchData:a,resetSearch:()=>{a.value={pageUrl:"",data:j({format:["00:00:00","23:59:59"]})},o.currentPage=1,i()},handleSearch:i,Search:y,Refresh:D,CirclePlus:F,RefreshRight:P,Delete:T,Download:C,tableData:n,paginationData:o,handleCurrentChange:d,handleSizeChange:p,ntFormat:(e,a)=>{let l=e.nt&&e.nt[a]||0;const t=e.fp,n=e.fpc;return"fp"==a&&t&&(l=t.startTime),"fpc"==a&&n&&(l=n.startTime),e.nt||l?l.toFixed(2)+"ms":"-"},handleDetail:e=>{t.value={},S((()=>t.value=e))},perfNode:t,project:r}}},[["render",function(e,a,l,t,n,u){const h=r("el-input"),_=r("el-form-item"),v=r("el-date-picker"),y=r("el-button"),D=r("el-form"),F=r("el-card"),P=r("el-table-column"),T=r("Histogram"),C=r("el-icon"),S=r("el-table"),j=r("el-pagination"),k=r("PerfDetail"),x=w("loading");return o(),b(g,null,[s("div",ae,[N((o(),d(F,{shadow:"never",class:"search-wrapper"},{default:p((()=>[i(D,{ref:"searchFormRef",inline:!0,model:t.searchData},{default:p((()=>[i(_,{prop:"pageUrl",label:"页面链接"},{default:p((()=>[i(h,{modelValue:t.searchData.pageUrl,"onUpdate:modelValue":a[0]||(a[0]=e=>t.searchData.pageUrl=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1}),i(_,{prop:"phone",label:"日期"},{default:p((()=>[i(v,{modelValue:t.searchData.data,"onUpdate:modelValue":a[1]||(a[1]=e=>t.searchData.data=e),type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])])),_:1}),i(_,null,{default:p((()=>[i(y,{type:"primary",onClick:t.handleSearch},{default:p((()=>[c("查询")])),_:1},8,["onClick"]),i(y,{onClick:t.resetSearch},{default:p((()=>[c("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1})),[[x,t.loading]]),N((o(),d(F,{shadow:"never"},{default:p((()=>[s("div",le,[1==t.project.projectType?(o(),d(S,{key:0,border:"",data:t.tableData},{default:p((()=>[i(P,{prop:"monitorAppId",label:"项目ID",align:"center"}),i(P,{prop:"pageUrl",label:"url",align:"center"}),i(P,{label:"会话性能指标",align:"center"},{default:p((()=>[i(P,{label:"Navigation 指标",align:"center"},{default:p((()=>[i(P,{label:"DNS 查询"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"DNS")),1)])),_:1}),i(P,{label:"TCP 链接"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"TCP")),1)])),_:1}),i(P,{label:"SSL 建连"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"SSL")),1)])),_:1}),i(P,{label:"TTFB 请求响应"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"TTFB")),1)])),_:1}),i(P,{label:"TRANS 内容传输"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"Trans")),1)])),_:1}),i(P,{label:"DOM 解析"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"DomParse")),1)])),_:1}),i(P,{label:"RES 资源加载"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"Res")),1)])),_:1})])),_:1}),i(P,{label:"性能关键指标",align:"center"},{default:p((()=>[i(P,{label:"白屏时间"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"FP")),1)])),_:1}),i(P,{label:"FCP 灰屏时间"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"FPC")),1)])),_:1}),i(P,{label:"FirseByte 首字节"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"FirseByte")),1)])),_:1}),i(P,{label:"DOMReady"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"DomReady")),1)])),_:1}),i(P,{label:"LOAD 加载完成"},{default:p((({row:e})=>[c(f(t.ntFormat(e,"Load")),1)])),_:1})])),_:1})])),_:1}),i(P,{label:"性能图表",fixed:"right",align:"center"},{default:p((({row:e})=>[i(y,{type:"text",onClick:a=>t.handleDetail(e)},{default:p((()=>[i(C,{style:{"vertical-align":"middle"}},{default:p((()=>[i(T)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):m("",!0),2==t.project.projectType?(o(),d(S,{key:1,border:"",data:t.tableData},{default:p((()=>[i(P,{prop:"nt.appLaunch",label:"小程序启动耗时",align:"center"}),i(P,{prop:"nt.route",label:"路由耗时",align:"center"}),i(P,{prop:"nt.firstRender",label:"页面渲染",align:"center"}),i(P,{prop:"nt.script",label:"js注入耗时",align:"center"}),i(P,{prop:"nt.loadPackage",label:"代码包下载耗时",align:"center"}),i(P,{label:"性能图表",fixed:"right",align:"center"},{default:p((({row:e})=>[i(y,{type:"text",onClick:a=>t.handleDetail(e)},{default:p((()=>[i(C,{style:{"vertical-align":"middle"}},{default:p((()=>[i(T)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):m("",!0)]),s("div",te,[i(j,{background:"",layout:t.paginationData.layout,"page-sizes":t.paginationData.pageSizes,total:t.paginationData.total,"page-size":t.paginationData.pageSize,currentPage:t.paginationData.currentPage,onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1})),[[x,t.loading]])]),t.perfNode.simpleUrl?(o(),d(k,{key:0,project:t.project,perfNode:t.perfNode},null,8,["project","perfNode"])):m("",!0)],64)}],["__scopeId","data-v-4b1b86b5"]]);export{ne as default};
