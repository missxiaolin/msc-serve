import{t as a,n as e}from"./index-2094dd5b.js";import{M as t,p as l,c as s,a as r,b as n}from"./index-59041d9b.js";import{u as i}from"./usePagination-b3cc9213.js";import{J as o,a as d}from"./jsHoursEchart-13d9dd23.js";import{r as c}from"./service-9bc33229.js";import{P as u,a as p}from"./index-58918b9d.js";import{E as m,l as h}from"./index-5d934b85.js";import{g,i as f,c as v,R as b,_ as D,r as C,o as P,a as _,k as y,l as E,b as x,y as U,z as j,F as w,A as T,d as k,e as z,n as S,M as V,N as J}from"./index-0620645c.js";const F={components:{MapEcharts:t,pageHoursEchart:l,JsHoursEchart:o,PerfEchart:u,Echarts:m},setup(){let t=g({activePage:"",pvCount:0,visitList:[],ipcregion:[],jsErrorTableData:[],perfEchartOPtion:[],project:{},EchartDatas:[],tableData:[]});const l=f({simpleUrl:"",data:a({format:["00:00:00","23:59:59"]})}),{paginationData:o,handleCurrentChange:u,handleSizeChange:m}=i((()=>{D()}),{layout:"total, prev, pager, next, jumper"}),D=async()=>{let a={simpleUrl:l.value.simpleUrl,startTime:l.value.data[0],endTime:l.value.data[1],page:o.currentPage,pageSize:o.pageSize},e=await s(a);e.success&&(t.pvCount=e.model.pvCount,o.total=e.model.count,t.visitList=e.model.list,C(t.visitList[0]||{}))},C=a=>{const{simpleUrl:e=""}=a;t.activePage=e,(async()=>{const a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage};let e=await n(a);if(!e.success)return!1;t.ipcregion=e.model})(),(async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await d(a);e.success&&(t.jsErrorTableData=e.model)})(),y(),E(),x()},P=v((()=>({startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage}))),_=v((()=>({data:l.value.data,simpleUrl:t.activePage}))),y=async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await p(a);e.success&&(t.perfEchartOPtion=e.model,t.project=e.model.project)},E=async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await r(a);e.success&&(t.EchartDatas=e.model)},x=async()=>{let a={startTime:l.value.data[0],endTime:l.value.data[1],simpleUrl:t.activePage},e=await function(a){return c({url:"/adm/api/agregate/list",method:"post",data:a})}(a);e.success&&(t.tableData=e.model)},U={toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},series:[{name:"Nightingale Chart",type:"pie",radius:[20,100],center:["50%","50%"],roseType:"area",itemStyle:{borderRadius:8},data:[]}]},j=v((()=>(a,e=t.EchartDatas)=>{var l;let s=h.cloneDeep(U);const r=e[a];let n=[];return null==(l=r.axisData)||l.forEach(((a,e)=>{n.push({name:a,value:r.seriesData[e]})})),s.series[0].data=n,s})),w=async()=>{D()};return b((()=>{w()})),{data:t,searchData:l,resetSearch:async()=>{l.value={simpleUrl:"",data:a({format:["00:00:00","23:59:59"]})}},init:w,paginationData:o,handleCurrentChange:u,handleSizeChange:m,visitPercent:a=>(a/t.pvCount*100).toFixed(2)+"%",numberFormat:e,handleVisitItem:C,hourPvUvParam:P,hourJsParam:_,echartData:j}}},I=a=>(V("data-v-299ec2fc"),a=a(),J(),a),A={class:"app-container"},H={class:"custom-main-contents visit-left-contents"},M={class:"card-header"},L=I((()=>x("span",null,"访问页面",-1))),O={class:"flex-1 flex flex-column"},R=["onClick"],N={class:"flex align-items-center"},B={class:"pager-wrapper mt20"},q={class:"visit-right-contents flex-1 flex flex-column"},G=I((()=>x("div",{class:"card-header"},[x("span",null,"健康概览")],-1))),K=I((()=>x("div",{class:"card-header"},[x("span",null,"JS错误聚类")],-1))),Q=I((()=>x("div",{class:"card-header"},[x("span",null,"API详情")],-1))),W={class:"flex-1 flex flex-column"},X=I((()=>x("div",{class:"card-header"},[x("span",null,"地理分布")],-1))),Y=I((()=>x("div",{class:"card-header"},[x("span",null,"终端分布")],-1)));const Z=D(F,[["render",function(a,e,t,l,s,r){const n=C("el-input"),i=C("el-form-item"),o=C("el-date-picker"),d=C("el-button"),c=C("el-form"),u=C("el-card"),p=C("ArrowRightBold"),m=C("el-icon"),h=C("el-scrollbar"),g=C("el-pagination"),f=C("pageHoursEchart"),v=C("el-tab-pane"),b=C("JsHoursEchart"),D=C("PerfEchart"),V=C("el-tabs"),J=C("el-table-column"),F=C("el-table"),I=C("MapEcharts"),Z=C("Echarts");return P(),_("div",A,[y(u,{class:"search-wrapper"},{default:E((()=>[y(c,{ref:"searchFormRef",inline:!0,model:l.searchData},{default:E((()=>[y(i,{prop:"simpleUrl",label:"页面链接"},{default:E((()=>[y(n,{modelValue:l.searchData.simpleUrl,"onUpdate:modelValue":e[0]||(e[0]=a=>l.searchData.simpleUrl=a),placeholder:"请输入带*的页面链接"},null,8,["modelValue"])])),_:1}),y(i,{prop:"phone",label:"日期"},{default:E((()=>[y(o,{modelValue:l.searchData.data,"onUpdate:modelValue":e[1]||(e[1]=a=>l.searchData.data=a),type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])])),_:1}),y(i,null,{default:E((()=>[y(d,{type:"primary",onClick:l.init},{default:E((()=>[U("查询")])),_:1},8,["onClick"]),y(d,{onClick:l.resetSearch},{default:E((()=>[U("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1}),x("section",H,[y(u,{class:"flex flex-1 flex-column visit-left-list"},{header:E((()=>[x("div",M,[L,x("span",null,"总PV: "+j(l.data.pvCount)+"次",1)])])),default:E((()=>[x("div",O,[y(h,null,{default:E((()=>[(P(!0),_(w,null,T(l.data.visitList,((a,e)=>(P(),_("dl",{class:S(["arco-list-item",{active:l.data.activePage==a.simpleUrl}]),key:e,onClick:e=>l.handleVisitItem(a)},[x("dt",null,j(a.simpleUrl),1),x("dd",N,[U(j(l.numberFormat(a.pageCount))+"次("+j(l.visitPercent(a.pageCount))+") ",1),y(m,null,{default:E((()=>[y(p)])),_:1})])],10,R)))),128))])),_:1}),x("div",B,[y(g,{background:"",layout:l.paginationData.layout,"page-sizes":l.paginationData.pageSizes,total:l.paginationData.total,"page-size":l.paginationData.pageSize,currentPage:l.paginationData.currentPage,onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])])),_:1}),x("div",q,[y(h,null,{default:E((()=>[y(u,null,{header:E((()=>[G])),default:E((()=>[y(V,{class:"demo-tabs"},{default:E((()=>[y(v,{label:"pv/uv"},{default:E((()=>[y(f,{params:l.hourPvUvParam},null,8,["params"])])),_:1}),y(v,{label:"JS报错"},{default:E((()=>[y(b,{params:l.hourJsParam},null,8,["params"])])),_:1}),1==l.data.project.projectType?(P(),k(v,{key:0,label:"平均性能"},{default:E((()=>[y(D,{options:l.data.perfEchartOPtion},null,8,["options"])])),_:1})):z("",!0)])),_:1})])),_:1}),y(u,{class:"mt20"},{header:E((()=>[K])),default:E((()=>[y(F,{data:l.data.jsErrorTableData,border:"",style:{width:"100%"}},{default:E((()=>[y(J,{prop:"errorMsg",label:"错误内容"}),y(J,{prop:"count",label:"错误数"}),y(J,{prop:"userCount",label:"影响用户数"})])),_:1},8,["data"])])),_:1}),y(u,{class:"mt20"},{header:E((()=>[Q])),default:E((()=>[x("div",W,[y(F,{border:"",data:l.data.tableData},{default:E((()=>[y(J,{prop:"pathName",label:"API名称",align:"left"}),y(J,{prop:"method",label:"请求方式",align:"center"}),y(J,{prop:"count",label:"请求次数",align:"center"}),y(J,{prop:"avgDuration",label:"平均耗时（ms）",align:"center"}),y(J,{prop:"avgDuration",label:"请求成功率",align:"center"},{default:E((({row:a})=>[U(j(100*(a.successCount/a.count).toFixed(2))+"% ",1)])),_:1})])),_:1},8,["data"])])])),_:1}),y(u,{class:"mt20"},{header:E((()=>[X])),default:E((()=>[y(I,{ipCregion:l.data.ipcregion},null,8,["ipCregion"])])),_:1}),y(u,{class:"mt20"},{header:E((()=>[Y])),default:E((()=>[y(V,{class:"demo-tabs"},{default:E((()=>[l.data.EchartDatas.os?(P(),k(v,{key:0,label:"系统版本"},{default:E((()=>[y(Z,{options:l.echartData("os")},null,8,["options"])])),_:1})):z("",!0),l.data.EchartDatas.device?(P(),k(v,{key:1,label:"浏览设备"},{default:E((()=>[y(Z,{options:l.echartData("device")},null,8,["options"])])),_:1})):z("",!0),l.data.EchartDatas.browser?(P(),k(v,{key:2,label:"浏览器版本"},{default:E((()=>[y(Z,{options:l.echartData("browser")},null,8,["options"])])),_:1})):z("",!0),l.data.EchartDatas.screen?(P(),k(v,{key:3,label:"设备分辨率"},{default:E((()=>[y(Z,{options:l.echartData("screen")},null,8,["options"])])),_:1})):z("",!0)])),_:1})])),_:1})])),_:1})])])])}],["__scopeId","data-v-299ec2fc"]]);export{Z as default};
