{"version":3,"file":"index-d8878c64.js","sources":["../../src/store/modules/user.ts","../../src/api/login/index.ts","../../src/views/login/index.vue","../../src/assets/img/logo.png"],"sourcesContent":["import { ref } from \"vue\";\nimport { resetRouter } from \"@/router\";\nimport { useTagsViewStore } from \"./tags-view\";\nimport { useSettingsStore } from \"./settings\";\nimport { defineStore } from \"pinia\";\nimport { type LoginRequestData } from \"@/api/login/types/login\";\nimport { loginApi } from \"@/api/login\";\nimport { setToken, getToken, removeToken, setCookie } from \"@/utils/cache/cookies\";\nimport { useGeneralStore } from \"@/store/modules/general\";\nconst generalStore = useGeneralStore();\n\nexport const useUserStore = defineStore(\"user\", () => {\n  const token = ref<string>(getToken() || \"\");\n  const tagsViewStore = useTagsViewStore();\n  const settingsStore = useSettingsStore();\n\n  /** 登录 */\n  const login = async ({ username, password }: LoginRequestData) => {\n    const { model, success } = await loginApi({ username, password });\n    if (success) {\n      setToken(model.token);\n      token.value = model.token || \"\";\n      setCookie('userId', model.userId || \"\")\n      generalStore.setProjectList(model.projectAll || []);\n    }\n  };\n\n  /** 登出 */\n  const logout = () => {\n    removeToken();\n    token.value = \"\";\n    resetRouter();\n    _resetTagsView();\n  };\n\n  /** 重置 Token */\n  const resetToken = () => {\n    removeToken();\n    token.value = \"\";\n  };\n\n  /** 重置 Visited Views 和 Cached Views */\n  const _resetTagsView = () => {\n    if (!settingsStore.cacheTagsView) {\n      tagsViewStore.delAllVisitedViews();\n      tagsViewStore.delAllCachedViews();\n    }\n  };\n\n  return { login, logout, resetToken };\n});\n","import { request } from \"@/utils/service\";\nimport type * as Login from \"./types/login\";\n\n/**\n * 登录\n * @returns\n */\n/** 登录并返回 Token */\nexport function loginApi(data: Login.LoginRequestData) {\n  return request<Login.LoginResponseData>({\n    url: \"/adm/login\",\n    method: \"post\",\n    data,\n  });\n}\n","<template>\n  <div class=\"login-container\">\n    <themeSwitch class=\"theme-switch\" />\n    <div class=\"login-card\">\n      <div class=\"title\">\n        <img src=\"@/assets/img/logo.png\" />\n      </div>\n      <div class=\"content\">\n        <el-form\n          ref=\"loginFormRef\"\n          :model=\"loginFormData\"\n          :rules=\"loginFormRules\"\n          @keyup.enter=\"handleLogin\"\n        >\n          <el-form-item prop=\"username\">\n            <el-input\n              v-model.trim=\"loginFormData.username\"\n              placeholder=\"用户名\"\n              type=\"text\"\n              tabindex=\"1\"\n              :prefix-icon=\"User\"\n              size=\"large\"\n            />\n          </el-form-item>\n          <el-form-item prop=\"password\">\n            <el-input\n              v-model.trim=\"loginFormData.password\"\n              placeholder=\"密码\"\n              type=\"password\"\n              tabindex=\"2\"\n              :prefix-icon=\"Lock\"\n              size=\"large\"\n              show-password\n            />\n          </el-form-item>\n          <el-button\n            :loading=\"loading\"\n            type=\"primary\"\n            size=\"large\"\n            @click.prevent=\"handleLogin\"\n            >登 录</el-button\n          >\n        </el-form>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { reactive, ref } from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport themeSwitch from \"@/components/themeSwitch/index.vue\";\nimport { type LoginRequestData } from \"@/api/login/types/login\";\nimport { type FormInstance, FormRules } from \"element-plus\";\nimport { User, Lock } from \"@element-plus/icons-vue\";\nimport { useUserStore } from \"@/store/modules/user\";\n\nexport default {\n  components: {\n    themeSwitch,\n  },\n  setup() {\n    const router = useRouter();\n    /** 登录表单数据 */\n    const loginFormData: LoginRequestData = reactive({\n      username: \"admin\",\n      password: \"12345678\",\n    });\n    /** 登录表单校验规则 */\n    const loginFormRules: FormRules = {\n      username: [{ required: true, message: \"请输入用户名\", trigger: \"blur\" }],\n      password: [\n        { required: true, message: \"请输入密码\", trigger: \"blur\" },\n        { min: 8, max: 16, message: \"长度在 8 到 16 个字符\", trigger: \"blur\" },\n      ],\n      code: [{ required: true, message: \"请输入验证码\", trigger: \"blur\" }],\n    };\n\n    /** 登录表单元素的引用 */\n    const loginFormRef = ref<FormInstance | null>(null);\n    /** 登录按钮 Loading */\n    const loading = ref(false);\n\n    /** 登录逻辑 */\n    const handleLogin = () => {\n      loginFormRef.value?.validate((valid: boolean, fields) => {\n        if (valid) {\n          loading.value = true;\n          useUserStore()\n            .login(loginFormData)\n            .then(() => {\n              router.push({ path: \"/\" });\n            })\n            .catch(() => {\n              loginFormData.password = \"\";\n            })\n            .finally(() => {\n              loading.value = false;\n            });\n        } else {\n          console.error(\"表单校验不通过\", fields);\n        }\n      });\n    };\n\n    return {\n      loginFormData,\n      loginFormRules,\n      handleLogin,\n      User,\n      Lock,\n      loading,\n      loginFormRef,\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.login-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  min-height: 100%;\n  .theme-switch {\n    position: fixed;\n    top: 5%;\n    right: 5%;\n    cursor: pointer;\n  }\n  .login-card {\n    width: 480px;\n    border-radius: 20px;\n    box-shadow: 0 0 10px #dcdfe6;\n    background-color: #fff;\n    overflow: hidden;\n    .title {\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 150px;\n      img {\n        height: 100px;\n      }\n    }\n    .content {\n      padding: 20px 50px 50px 50px;\n      :deep(.el-input-group__append) {\n        padding: 0;\n        overflow: hidden;\n        .el-image {\n          width: 100px;\n          height: 40px;\n          border-left: 0px;\n          user-select: none;\n          cursor: pointer;\n          text-align: center;\n        }\n      }\n      .el-button {\n        width: 100%;\n        margin-top: 10px;\n      }\n    }\n  }\n}\n</style>\n","export default \"__VITE_ASSET__ab211233__\""],"names":["generalStore","useGeneralStore","useUserStore","defineStore","token","ref","getToken","tagsViewStore","useTagsViewStore","settingsStore","useSettingsStore","_resetTagsView","cacheTagsView","delAllVisitedViews","delAllCachedViews","login","async","username","password","model","success","data","request","url","method","setToken","value","setCookie","userId","setProjectList","projectAll","logout","resetToken","_sfc_main","components","themeSwitch","setup","router","useRouter","loginFormData","reactive","loginFormRef","loading","loginFormRules","required","message","trigger","min","max","code","handleLogin","_a","validate","valid","fields","then","push","path","catch","finally","console","error","User","Lock","class","n","_pushScopeId","_popScopeId","createBaseVNode","src","_component_el_form","_resolveComponent","_openBlock","_createElementBlock","_hoisted_1","_createVNode","_component_themeSwitch","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","$setup","rules","onKeyup","_withKeys","default","_withCtx","_component_el_form_item","prop","_component_el_input","_cache","$event","modelModifiers","trim","placeholder","type","tabindex","_","size","_component_el_button","onClick","_withModifiers"],"mappings":"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"}