import{P as e,W as a,p as t}from"./index-3546ee50.js";import{E as l}from"./index-0ab3036e.js";import{c as r,_ as n,r as i,o,d,l as s,k as p,y as u,z as c,i as f,b as g,a as m,e as h,M as x,N as b,R as y,a8 as v,a9 as w,aa as V,ab as k,ac as _,ad as T,Q as S,ae as j,S as N,F as P}from"./index-5b0b7946.js";import{t as D}from"./index-bcca8a94.js";import{u as L}from"./usePagination-b39297d5.js";import"./service-53f85039.js";import"./validate-f5786776.js";const C=n({components:{Echarts:l},props:{options:{type:Object,required:!0}},name:"aliPerfEchart",setup:e=>({navigationEchart:r((()=>{var a;const t=(null==(a=e.options)?void 0:a.nt)||{};if(!t||!Object.keys(t).length)return{};const l=["firstRenderduration","evaluateScriptduration","routeduration","appLaunchduration","downloadPackageduration"],r=[],n=[];l.forEach(((e,a)=>{const i=(t[e]||0).toFixed(2);n.push(`${i}ms`);const o={name:e,type:"bar",stack:"Total",label:{show:!0,position:"right"},data:[]};for(let t=0,r=l.length;t<r;t++)a==t?o.data.push(i):o.data.push("-");r.push(o)}));const{firstRenderduration:i=0,evaluateScriptduration:o=0,routeduration:d=0,appLaunchduration:s=0,downloadPackageduration:p=0}=t,u=[+i.toFixed(2),+o.toFixed(2),+d.toFixed(2),+s.toFixed(2),+p.toFixed(2)],c=[];for(let e=0;e<u.length;e++){const a=JSON.parse(JSON.stringify(u)).reverse().slice(0,e+1).reduce(((e,a)=>e+a));c.unshift(+a.toFixed(2))}const{placeholderData:f}=function(e){const a=[0],t=[e[0]],l=["-"];return e.forEach(((r,n)=>{if(n!==e.length-1){const i=e[n+1]-r;i>0?(a.push(r),t.push(i),l.push("-")):(a.push(r+i),t.push(0),l.push(Math.abs(i)))}})),{placeholderData:a,data1:t,data2:l}}(c.reverse());return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(e){for(let a=1,t=e.length;a<t;a++){let{name:t,value:l,seriesName:r,color:n}=e[a];if("-"!==l)return`${t}</br><span style="display:flex; align-items: center;">\n                      <i style="display:block;margin-right:5px;border-radius:50%;width:10px;height:10px;left:5px;background-color:${n}"></i>${r}:\n                      <i style="padding-left: 30px;">${l}</i>\n                  </span>`}}},xAxis:{type:"value",show:!1,axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}}},yAxis:[{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:["页面渲染","JS注入","路由","小程序启动","代码包下载"]},{axisLine:{show:!1},axisTick:{show:!1},splitLine:{lineStyle:{type:"dotted"}},type:"category",data:n}],seriesColorReset:!1,series:[{name:"Placeholder",type:"bar",stack:"Total",silent:!0,itemStyle:{borderColor:"transparent",color:"transparent"},emphasis:{itemStyle:{borderColor:"transparent",color:"transparent"}},data:f.reverse()},...r]}}))})},[["render",function(e,a,t,l,r,n){const s=i("Echarts");return o(),d(s,{options:l.navigationEchart},null,8,["options"])}]]);const R=n({props:{data:{type:Array,defualt:()=>[]}},setup:e=>({NFTable:r((()=>{const a=["startTime","responseEnd","duration","dns","tcp","ssl","ttfb","contentDownload"];if(!e.data||!e.data.length)return[];return e.data.map((e=>{for(let t in e)a.includes(t)&&(e[t]=(e[t]||0).toFixed(2)+"ms");return e}))}))})},[["render",function(e,a,t,l,r,n){const f=i("el-table-column"),g=i("el-table");return o(),d(g,{data:l.NFTable,stripe:"","max-height":"500"},{default:s((()=>[p(f,{prop:"name",label:"资源名称",fixed:"",width:"200"}),p(f,{prop:"transferSize",label:"资源大小",fixed:""}),p(f,{prop:"initiatorType",label:"资源类型"}),p(f,{prop:"responseStatus",label:"资源状态"}),p(f,{prop:"startTime",label:"开始时间"}),p(f,{prop:"duration",label:"资源的总耗时"}),p(f,{prop:"responseEnd",label:"资源下载时间"}),p(f,{prop:"renderBlockingStatus",label:"否有渲染阻塞",fixed:"right"}),p(f,{label:"命中缓存",fixed:"right"},{default:s((({row:e})=>[u(c("cache"==e.deliveryType?"浏览器缓存":"服务器获取"),1)])),_:1})])),_:1},8,["data"])}]]);const F={components:{PerfEchart:e,WxPerfEchart:a,WxPerfResTable:n({props:{data:{type:Array,defualt:()=>[]}},setup(e){function a(e){const a=new Date(e);return`${a.getFullYear()}-${("0"+(a.getMonth()+1)).slice(-2)}-${("0"+a.getDate()).slice(-2)} ${("0"+a.getHours()).slice(-2)}:${("0"+a.getMinutes()).slice(-2)}:${("0"+a.getSeconds()).slice(-2)}`}return{NFTable:r((()=>{if(!e.data||!e.data.length)return[];return e.data.map((e=>(e.startTime=a(parseInt(e.startTime)),e.domainLookupStart=a(parseInt(e.domainLookupStart)),e.domainLookupEnd=a(parseInt(e.domainLookupEnd)),e)))}))}}},[["render",function(e,a,t,l,r,n){const u=i("el-table-column"),c=i("el-table");return o(),d(c,{data:l.NFTable,stripe:"","max-height":"500"},{default:s((()=>[p(u,{prop:"name",label:"资源名称",fixed:"",width:"200"}),p(u,{prop:"transferSize",label:"资源大小",fixed:""}),p(u,{prop:"initiatorType",label:"资源类型"}),p(u,{prop:"startTime",label:"开始时间"}),p(u,{prop:"domainLookupStart",label:"DNS查询开始"}),p(u,{prop:"domainLookupEnd",label:"DNS查询结束"}),p(u,{prop:"duration",label:"资源的总耗时"})])),_:1},8,["data"])}]]),AliPerfEchart:C,PerfResTable:R,AliPerfResTable:n({props:{data:{type:Array,defualt:()=>[]}},setup(e){function a(e){const a=new Date(e);return`${a.getFullYear()}-${("0"+(a.getMonth()+1)).slice(-2)}-${("0"+a.getDate()).slice(-2)} ${("0"+a.getHours()).slice(-2)}:${("0"+a.getMinutes()).slice(-2)}:${("0"+a.getSeconds()).slice(-2)}`}return{NFTable:r((()=>{if(!e.data||!e.data.length)return[];return e.data.map((e=>(e.startTime=a(parseInt(e.startTime)),e.domainLookupStart=a(parseInt(e.domainLookupStart)),e.domainLookupEnd=a(parseInt(e.domainLookupEnd)),e)))}))}}},[["render",function(e,a,t,l,r,n){const u=i("el-table-column"),c=i("el-table");return o(),d(c,{data:l.NFTable,stripe:"","max-height":"500"},{default:s((()=>[p(u,{prop:"name",label:"资源名称",fixed:"",width:"200"}),p(u,{prop:"transferSize",label:"资源大小",fixed:""}),p(u,{prop:"initiatorType",label:"资源类型"}),p(u,{prop:"startTime",label:"开始时间"}),p(u,{prop:"domainLookupStart",label:"DNS查询开始"}),p(u,{prop:"domainLookupEnd",label:"DNS查询结束"}),p(u,{prop:"duration",label:"资源的总耗时"})])),_:1},8,["data"])}]])},props:{perfNode:{type:Object,required:!0},project:{type:Object,required:!0}},name:"perfDetail",setup(e){const{perfNode:a,project:t}=e;return{drawerVisible:f(!0),perfEchartOPtion:r((()=>{const e=a["navigation-timing"]||{};let l={};return 1==t.projectType&&(l={nt:e.textValue,fp:a["first-paint"]||{}}),2==t.projectType&&(l={nt:a.textValue}),3==t.projectType&&(l={nt:a.textValue}),l}))}}},E=e=>(x("data-v-ec54a52d"),e=e(),b(),e),$={class:"detail-wapper flex-1"},z={class:"detail-top-content"},U={class:"flex basic-info"},O={key:0},I={class:"other-basic"},A={class:"detail-bottom-content flex flex-1"},M={class:"navigation-content"},W={key:0,class:"title"},q={key:1,class:"flex navigation-target"},H=E((()=>g("h2",{class:"title"},"页面加载瀑布图",-1))),J=E((()=>g("h2",{class:"title"},"会话性能指标",-1))),B=E((()=>g("h3",{class:"title"},"RF 资源",-1)));const Y={class:"app-container"},Q={class:"table-wrapper"},G={class:"pager-wrapper"};const K=n({name:"Performance",components:{PerfDetail:n(F,[["render",function(e,a,t,l,r,n){const f=i("Edit"),x=i("el-icon"),b=i("Clock"),y=i("PerfEchart"),v=i("WxPerfEchart"),w=i("AliPerfEchart"),V=i("PerfResTable"),k=i("WxPerfResTable"),_=i("AliPerfResTable"),T=i("el-scroll"),S=i("el-drawer");return o(),d(S,{modelValue:l.drawerVisible,"onUpdate:modelValue":a[0]||(a[0]=e=>l.drawerVisible=e),ref:"drawerRef",title:"性能指标查看",direction:"rtl",size:"95%","z-index":9999,"append-to-body":!0},{default:s((()=>{var e,a,r,n;return[g("section",$,[g("div",z,[g("dl",U,[(null==(e=t.perfNode)?void 0:e.uuId)?(o(),m("dd",O,[p(x,{size:15},{default:s((()=>[p(f)])),_:1}),u(c(null==(a=t.perfNode)?void 0:a.uuId),1)])):h("",!0),g("dd",null,[p(x,{size:15},{default:s((()=>[p(b)])),_:1}),u(c(null==(r=t.perfNode)?void 0:r.happenTime),1)])]),g("div",I,c(null==(n=t.perfNode)?void 0:n.simpleUrl),1)]),g("div",A,[p(T,{ref:"scrollbarRef",trigger:"hover",class:"flex-1",direction:"all"},{default:s((()=>[g("div",M,[1==t.project.projectType?(o(),m("h2",W,"会话性能指标")):h("",!0),1==t.project.projectType?(o(),m("dl",q,[g("dd",null," CLS："+c(t.perfNode["cumulative-layout-shift"]&&t.perfNode["cumulative-layout-shift"].numValue||0)+" ms ",1),g("dd",null," FCP："+c(t.perfNode["first-contentful-paint"]&&t.perfNode["first-contentful-paint"].numValue||0)+" ms ",1),g("dd",null," FID："+c(t.perfNode["first-input-delay"]&&t.perfNode["first-input-delay"].textValue.delay||0)+" ms ",1),g("dd",null," FP："+c(t.perfNode["first-paint"]&&t.perfNode["first-paint"].numValue||0)+" ms ",1),g("dd",null," LCP："+c(t.perfNode["largest-contentful-paint"]&&t.perfNode["largest-contentful-paint"].numValue||0)+" ms ",1)])):h("",!0),H,g("div",null,[1==t.project.projectType?(o(),d(y,{key:0,options:l.perfEchartOPtion},null,8,["options"])):h("",!0),2==t.project.projectType?(o(),d(v,{key:1,options:l.perfEchartOPtion},null,8,["options"])):h("",!0),3==t.project.projectType?(o(),d(w,{key:2,options:l.perfEchartOPtion},null,8,["options"])):h("",!0)]),J,g("div",null,[B,1==t.project.projectType?(o(),d(V,{key:0,data:t.perfNode["resource-flow"]&&t.perfNode["resource-flow"].textValue?t.perfNode["resource-flow"].textValue:[]},null,8,["data"])):h("",!0),2==t.project.projectType?(o(),d(k,{key:1,data:t.perfNode["wx-resource-flow"]&&t.perfNode["wx-resource-flow"].textValue},null,8,["data"])):h("",!0),3==t.project.projectType?(o(),d(_,{key:2,data:t.perfNode["ali-resource-flow"]&&t.perfNode["ali-resource-flow"].textValue},null,8,["data"])):h("",!0)])])])),_:1},512)])])]})),_:1},8,["modelValue"])}],["__scopeId","data-v-ec54a52d"]])},setup(){const e=f(!1),a=f({simpleUrl:"",data:D({format:["00:00:00","23:59:59"]})}),l=f({}),r=f([]),n=f({}),{paginationData:i,handleCurrentChange:o,handleSizeChange:d}=L((()=>{s()}));y((()=>{s()}));const s=async()=>{let e={simpleUrl:a.value.simpleUrl,startTime:a.value.data[0],endTime:a.value.data[1],page:i.currentPage,pageSize:i.pageSize},l=await t(e);l.success&&(i.total=l.model.count,r.value=l.model.list,n.value=l.model.project)};return{loading:e,searchData:a,resetSearch:()=>{a.value={simpleUrl:"",data:D({format:["00:00:00","23:59:59"]})},i.currentPage=1,s()},handleSearch:s,Search:v,Refresh:w,CirclePlus:V,RefreshRight:k,Delete:_,Download:T,tableData:r,paginationData:i,handleCurrentChange:o,handleSizeChange:d,handleDetail:e=>{l.value={},S((()=>l.value=e))},perfNode:l,project:n}}},[["render",function(e,a,t,l,r,n){const f=i("el-input"),x=i("el-form-item"),b=i("el-date-picker"),y=i("el-button"),v=i("el-form"),w=i("el-card"),V=i("el-table-column"),k=i("Histogram"),_=i("el-icon"),T=i("el-table"),S=i("el-pagination"),D=i("PerfDetail"),L=j("loading");return o(),m(P,null,[g("div",Y,[N((o(),d(w,{shadow:"never",class:"search-wrapper"},{default:s((()=>[p(v,{ref:"searchFormRef",inline:!0,model:l.searchData},{default:s((()=>[p(x,{prop:"simpleUrl",label:"页面链接"},{default:s((()=>[p(f,{modelValue:l.searchData.simpleUrl,"onUpdate:modelValue":a[0]||(a[0]=e=>l.searchData.simpleUrl=e),placeholder:"请输入"},null,8,["modelValue"])])),_:1}),p(x,{prop:"phone",label:"日期"},{default:s((()=>[p(b,{modelValue:l.searchData.data,"onUpdate:modelValue":a[1]||(a[1]=e=>l.searchData.data=e),type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])])),_:1}),p(x,null,{default:s((()=>[p(y,{type:"primary",onClick:l.handleSearch},{default:s((()=>[u("查询")])),_:1},8,["onClick"]),p(y,{onClick:l.resetSearch},{default:s((()=>[u("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1})),[[L,l.loading]]),N((o(),d(w,{shadow:"never"},{default:s((()=>[g("div",Q,[1==l.project.projectType?(o(),d(T,{key:0,border:"",data:l.tableData},{default:s((()=>[p(V,{prop:"simpleUrl",label:"url",align:"center"}),p(V,{label:"会话性能指标",align:"center"},{default:s((()=>[p(V,{label:"Navigation 指标",align:"center"},{default:s((()=>[p(V,{label:"DNS 查询"},{default:s((({row:e})=>[u(c(e["navigation-timing"]&&e["navigation-timing"].textValue.dnsLookup?e["navigation-timing"].textValue.dnsLookup:0),1)])),_:1}),p(V,{label:"TCP 链接"},{default:s((({row:e})=>[u(c(e["navigation-timing"]&&e["navigation-timing"].textValue.initialConnection?e["navigation-timing"].textValue.initialConnection:0),1)])),_:1}),p(V,{label:"SSL 建连"},{default:s((({row:e})=>[u(c(e["navigation-timing"]&&e["navigation-timing"].textValue.ssl?e["navigation-timing"].textValue.ssl:0),1)])),_:1}),p(V,{label:"TTFB 请求响应"},{default:s((({row:e})=>[u(c(e["navigation-timing"]&&e["navigation-timing"].textValue.ttfb?e["navigation-timing"].textValue.ttfb:0),1)])),_:1}),p(V,{label:"TRANS 内容传输"},{default:s((({row:e})=>[u(c(e["navigation-timing"]&&e["navigation-timing"].textValue.contentDownload?e["navigation-timing"].textValue.contentDownload:0),1)])),_:1}),p(V,{label:"DOM 解析"},{default:s((({row:e})=>[u(c(e["navigation-timing"]&&e["navigation-timing"].textValue.domParse?e["navigation-timing"].textValue.domParse:0),1)])),_:1}),p(V,{label:"RES 资源加载"},{default:s((({row:e})=>[u(c(e["navigation-timing"]&&e["navigation-timing"].textValue.resourceLoad?e["navigation-timing"].textValue.resourceLoad:0),1)])),_:1})])),_:1}),p(V,{label:"性能关键指标",align:"center"},{default:s((()=>[p(V,{label:"白屏时间"},{default:s((({row:e})=>[u(c(e["first-paint"]&&e["first-paint"].value?e["first-paint"].value:"-"),1)])),_:1}),p(V,{label:"FCP 灰屏时间"},{default:s((({row:e})=>[u(c(e["first-contentful-paint"]&&e["first-contentful-paint"].value?e["first-contentful-paint"].value:"-"),1)])),_:1}),p(V,{label:"DOM完成加载"},{default:s((({row:e})=>[u(c(e["navigation-timing"]&&e["navigation-timing"].textValue.domReady?e["navigation-timing"].textValue.domReady:0),1)])),_:1}),p(V,{label:"页面完全加载"},{default:s((({row:e})=>[u(c(e["navigation-timing"]&&e["navigation-timing"].textValue.pageLoad?e["navigation-timing"].textValue.pageLoad:0),1)])),_:1})])),_:1})])),_:1}),p(V,{label:"性能图表",fixed:"right",align:"center"},{default:s((({row:e})=>[p(y,{type:"text",onClick:a=>l.handleDetail(e)},{default:s((()=>[p(_,{style:{"vertical-align":"middle"}},{default:s((()=>[p(k)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):h("",!0),2==l.project.projectType?(o(),d(T,{key:1,border:"",data:l.tableData},{default:s((()=>[p(V,{prop:"simpleUrl",label:"url",align:"center"}),p(V,{label:"小程序启动耗时",align:"center"},{default:s((({row:e})=>[u(c(e.textValue.appLaunchduration?`${e.textValue.appLaunchduration.toFixed(2)}ms`:"-"),1)])),_:1}),p(V,{prop:"textValue.routeduration",label:"路由耗时",align:"center"},{default:s((({row:e})=>[u(c(e.textValue.routeduration?`${e.textValue.routeduration.toFixed(2)}ms`:"-"),1)])),_:1}),p(V,{label:"页面渲染",align:"center"},{default:s((({row:e})=>[u(c(e.textValue.firstRenderviewLayerReadyTime?e.textValue.firstRenderviewLayerRenderEndTime-e.textValue.firstRenderviewLayerReadyTime+"ms":"-"),1)])),_:1}),p(V,{prop:"textValue.evaluateScriptduration",label:"js注入耗时",align:"center"},{default:s((({row:e})=>[u(c(e.textValue.evaluateScriptduration?`${e.textValue.evaluateScriptduration.toFixed(2)}ms`:"-"),1)])),_:1}),p(V,{prop:"textValue.downloadPackageduration",label:"代码包下载耗时",align:"center"},{default:s((({row:e})=>[u(c(e.textValue.downloadPackageduration?`${e.textValue.downloadPackageduration.toFixed(2)}ms`:"-"),1)])),_:1}),p(V,{label:"性能图表",fixed:"right",align:"center"},{default:s((({row:e})=>[p(y,{type:"text",onClick:a=>l.handleDetail(e)},{default:s((()=>[p(_,{style:{"vertical-align":"middle"}},{default:s((()=>[p(k)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):h("",!0),3==l.project.projectType?(o(),d(T,{key:2,border:"",data:l.tableData},{default:s((()=>[p(V,{prop:"simpleUrl",label:"url",align:"center"}),p(V,{label:"小程序启动耗时",align:"center"},{default:s((({row:e})=>[u(c(e.textValue.appLaunchduration?`${e.textValue.appLaunchduration.toFixed(2)}ms`:"-"),1)])),_:1}),p(V,{prop:"textValue.routeduration",label:"路由耗时",align:"center"},{default:s((({row:e})=>[u(c(e.textValue.routeduration?`${e.textValue.routeduration.toFixed(2)}ms`:"-"),1)])),_:1}),p(V,{label:"页面渲染",align:"center"},{default:s((({row:e})=>[u(c(e.textValue.firstRenderviewLayerReadyTime?e.textValue.firstRenderviewLayerRenderEndTime-e.textValue.firstRenderviewLayerReadyTime+"ms":"-"),1)])),_:1}),p(V,{prop:"textValue.evaluateScriptduration",label:"js注入耗时",align:"center"},{default:s((({row:e})=>[u(c(e.textValue.evaluateScriptduration?`${e.textValue.evaluateScriptduration.toFixed(2)}ms`:"-"),1)])),_:1}),p(V,{prop:"textValue.downloadPackageduration",label:"代码包下载耗时",align:"center"},{default:s((({row:e})=>[u(c(e.textValue.downloadPackageduration?`${e.textValue.downloadPackageduration.toFixed(2)}ms`:"-"),1)])),_:1}),p(V,{label:"性能图表",fixed:"right",align:"center"},{default:s((({row:e})=>[p(y,{type:"text",onClick:a=>l.handleDetail(e)},{default:s((()=>[p(_,{style:{"vertical-align":"middle"}},{default:s((()=>[p(k)])),_:1})])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])):h("",!0)]),g("div",G,[p(S,{background:"",layout:l.paginationData.layout,"page-sizes":l.paginationData.pageSizes,total:l.paginationData.total,"page-size":l.paginationData.pageSize,currentPage:l.paginationData.currentPage,onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])),_:1})),[[L,l.loading]])]),l.perfNode.simpleUrl?(o(),d(D,{key:0,project:l.project,perfNode:l.perfNode},null,8,["project","perfNode"])):h("",!0)],64)}],["__scopeId","data-v-d4434a59"]]);export{K as default};
//# sourceMappingURL=list-23f015f6.js.map
