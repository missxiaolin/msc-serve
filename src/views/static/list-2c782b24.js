var a=(a,e,t)=>new Promise(((l,s)=>{var r=a=>{try{i(t.next(a))}catch(e){s(e)}},n=a=>{try{i(t.throw(a))}catch(e){s(e)}},i=a=>a.done?l(a.value):Promise.resolve(a.value).then(r,n);i((t=t.apply(a,e)).next())}));import{t as e,n as t}from"./index-01044443.js";import{M as l,p as s,c as r,a as n,b as i}from"./index-1d600182.js";import{u as o}from"./usePagination-486b724a.js";import{J as d,a as u}from"./jsHoursEchart-5aef75c8.js";import{r as c}from"./service-f992a9ed.js";import{P as p,a as m}from"./index-b5f2ae4d.js";import{E as h,l as f}from"./index-ff87e842.js";import{g as v,i as g,c as b,R as D,_ as P,r as C,o as _,a as x,k as y,l as E,x as U,b as T,y as k,F as w,A as j,d as S,e as z,n as V,M as J,N as F}from"./index-f4eb0487.js";const I={components:{MapEcharts:l,pageHoursEchart:s,JsHoursEchart:d,PerfEchart:p,Echarts:h},setup(){let l=v({activePage:"",pvCount:0,visitList:[],ipcregion:[],jsErrorTableData:[],perfEchartOPtion:[],EchartDatas:[],tableData:[]});const s=g({simpleUrl:"",data:e({format:["00:00:00","23:59:59"]})}),{paginationData:d,handleCurrentChange:p,handleSizeChange:h}=o((()=>{P()}),{layout:"total, prev, pager, next, jumper"}),P=()=>a(this,null,(function*(){let a={simpleUrl:s.value.simpleUrl,startTime:s.value.data[0],endTime:s.value.data[1],page:d.currentPage,pageSize:d.pageSize},e=yield r(a);e.success&&(l.pvCount=e.model.pvCount,d.total=e.model.count,l.visitList=e.model.list,x(l.visitList[0]||{}))})),C=()=>a(this,null,(function*(){const a={startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:l.activePage};let e=yield i(a);if(!e.success)return!1;l.ipcregion=e.model})),_=()=>a(this,null,(function*(){let a={startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:l.activePage},e=yield u(a);e.success&&(l.jsErrorTableData=e.model)})),x=a=>{const{simpleUrl:e=""}=a;l.activePage=e,C(),_(),U(),T(),k()},y=b((()=>({startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:l.activePage}))),E=b((()=>({data:s.value.data,simpleUrl:l.activePage}))),U=()=>a(this,null,(function*(){let a={startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:l.activePage},e=yield m(a);e.success&&(l.perfEchartOPtion=e.model)})),T=()=>a(this,null,(function*(){let a={startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:l.activePage},e=yield n(a);e.success&&(l.EchartDatas=e.model)})),k=()=>a(this,null,(function*(){let a={startTime:s.value.data[0],endTime:s.value.data[1],simpleUrl:l.activePage},e=yield function(a){return c({url:"/adm/api/agregate/list",method:"post",data:a})}(a);e.success&&(l.tableData=e.model)})),w={toolbox:{show:!0,feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},series:[{name:"Nightingale Chart",type:"pie",radius:[20,100],center:["50%","50%"],roseType:"area",itemStyle:{borderRadius:8},data:[]}]},j=b((()=>(a,e=l.EchartDatas)=>{var t;let s=f.cloneDeep(w);const r=e[a];let n=[];return null==(t=r.axisData)||t.forEach(((a,e)=>{n.push({name:a,value:r.seriesData[e]})})),s.series[0].data=n,s})),S=()=>a(this,null,(function*(){P()}));return D((()=>{S()})),{data:l,searchData:s,resetSearch:()=>a(this,null,(function*(){s.value={simpleUrl:"",data:e({format:["00:00:00","23:59:59"]})}})),init:S,paginationData:d,handleCurrentChange:p,handleSizeChange:h,visitPercent:a=>(a/l.pvCount*100).toFixed(2)+"%",numberFormat:t,handleVisitItem:x,hourPvUvParam:y,hourJsParam:E,echartData:j}}},A=a=>(J("data-v-e354a246"),a=a(),F(),a),H={class:"app-container"},M={class:"custom-main-contents visit-left-contents"},L={class:"card-header"},O=A((()=>T("span",null,"访问页面",-1))),R={class:"flex-1 flex flex-column"},N=["onClick"],B={class:"flex align-items-center"},q={class:"pager-wrapper mt20"},G={class:"visit-right-contents flex-1 flex flex-column"},K=A((()=>T("div",{class:"card-header"},[T("span",null,"健康概览")],-1))),Q=A((()=>T("div",{class:"card-header"},[T("span",null,"JS错误聚类")],-1))),W=A((()=>T("div",{class:"card-header"},[T("span",null,"API详情")],-1))),X={class:"flex-1 flex flex-column"},Y=A((()=>T("div",{class:"card-header"},[T("span",null,"地理分布")],-1))),Z=A((()=>T("div",{class:"card-header"},[T("span",null,"终端分布")],-1)));const $=P(I,[["render",function(a,e,t,l,s,r){const n=C("el-input"),i=C("el-form-item"),o=C("el-date-picker"),d=C("el-button"),u=C("el-form"),c=C("el-card"),p=C("ArrowRightBold"),m=C("el-icon"),h=C("el-scrollbar"),f=C("el-pagination"),v=C("pageHoursEchart"),g=C("el-tab-pane"),b=C("JsHoursEchart"),D=C("PerfEchart"),P=C("el-tabs"),J=C("el-table-column"),F=C("el-table"),I=C("MapEcharts"),A=C("Echarts");return _(),x("div",H,[y(c,{class:"search-wrapper"},{default:E((()=>[y(u,{ref:"searchFormRef",inline:!0,model:l.searchData},{default:E((()=>[y(i,{prop:"simpleUrl",label:"页面链接"},{default:E((()=>[y(n,{modelValue:l.searchData.simpleUrl,"onUpdate:modelValue":e[0]||(e[0]=a=>l.searchData.simpleUrl=a),placeholder:"请输入带*的页面链接"},null,8,["modelValue"])])),_:1}),y(i,{prop:"phone",label:"日期"},{default:E((()=>[y(o,{modelValue:l.searchData.data,"onUpdate:modelValue":e[1]||(e[1]=a=>l.searchData.data=a),type:"datetimerange","range-separator":"-","start-placeholder":"开始时间","end-placeholder":"结束时间"},null,8,["modelValue"])])),_:1}),y(i,null,{default:E((()=>[y(d,{type:"primary",onClick:l.init},{default:E((()=>[U("查询")])),_:1},8,["onClick"]),y(d,{onClick:l.resetSearch},{default:E((()=>[U("重置")])),_:1},8,["onClick"])])),_:1})])),_:1},8,["model"])])),_:1}),T("section",M,[y(c,{class:"flex flex-1 flex-column visit-left-list"},{header:E((()=>[T("div",L,[O,T("span",null,"总PV: "+k(l.data.pvCount)+"次",1)])])),default:E((()=>[T("div",R,[y(h,null,{default:E((()=>[(_(!0),x(w,null,j(l.data.visitList,((a,e)=>(_(),x("dl",{class:V(["arco-list-item",{active:l.data.activePage==a.simpleUrl}]),key:e,onClick:e=>l.handleVisitItem(a)},[T("dt",null,k(a.simpleUrl),1),T("dd",B,[U(k(l.numberFormat(a.pageCount))+"次("+k(l.visitPercent(a.pageCount))+") ",1),y(m,null,{default:E((()=>[y(p)])),_:1})])],10,N)))),128))])),_:1}),T("div",q,[y(f,{background:"",layout:l.paginationData.layout,"page-sizes":l.paginationData.pageSizes,total:l.paginationData.total,"page-size":l.paginationData.pageSize,currentPage:l.paginationData.currentPage,onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])])])),_:1}),T("div",G,[y(h,null,{default:E((()=>[y(c,null,{header:E((()=>[K])),default:E((()=>[y(P,{class:"demo-tabs"},{default:E((()=>[y(g,{label:"pv/uv"},{default:E((()=>[y(v,{params:l.hourPvUvParam},null,8,["params"])])),_:1}),y(g,{label:"JS报错"},{default:E((()=>[y(b,{params:l.hourJsParam},null,8,["params"])])),_:1}),y(g,{label:"平均性能"},{default:E((()=>[y(D,{options:l.data.perfEchartOPtion},null,8,["options"])])),_:1})])),_:1})])),_:1}),y(c,{class:"mt20"},{header:E((()=>[Q])),default:E((()=>[y(F,{data:l.data.jsErrorTableData,border:"",style:{width:"100%"}},{default:E((()=>[y(J,{prop:"errorMsg",label:"错误内容"}),y(J,{prop:"count",label:"错误数"}),y(J,{prop:"userCount",label:"影响用户数"})])),_:1},8,["data"])])),_:1}),y(c,{class:"mt20"},{header:E((()=>[W])),default:E((()=>[T("div",X,[y(F,{border:"",data:l.data.tableData},{default:E((()=>[y(J,{prop:"pathName",label:"API名称",align:"left"}),y(J,{prop:"method",label:"请求方式",align:"center"}),y(J,{prop:"count",label:"请求次数",align:"center"}),y(J,{prop:"avgDuration",label:"平均耗时（ms）",align:"center"}),y(J,{prop:"avgDuration",label:"请求成功率",align:"center"},{default:E((({row:a})=>[U(k(100*(a.successCount/a.count).toFixed(2))+"% ",1)])),_:1})])),_:1},8,["data"])])])),_:1}),y(c,{class:"mt20"},{header:E((()=>[Y])),default:E((()=>[y(I,{ipCregion:l.data.ipcregion},null,8,["ipCregion"])])),_:1}),y(c,{class:"mt20"},{header:E((()=>[Z])),default:E((()=>[y(P,{class:"demo-tabs"},{default:E((()=>[l.data.EchartDatas.os?(_(),S(g,{key:0,label:"系统版本"},{default:E((()=>[y(A,{options:l.echartData("os")},null,8,["options"])])),_:1})):z("",!0),l.data.EchartDatas.device?(_(),S(g,{key:1,label:"浏览设备"},{default:E((()=>[y(A,{options:l.echartData("device")},null,8,["options"])])),_:1})):z("",!0),l.data.EchartDatas.browser?(_(),S(g,{key:2,label:"浏览器版本"},{default:E((()=>[y(A,{options:l.echartData("browser")},null,8,["options"])])),_:1})):z("",!0),l.data.EchartDatas.screen?(_(),S(g,{key:3,label:"设备分辨率"},{default:E((()=>[y(A,{options:l.echartData("screen")},null,8,["options"])])),_:1})):z("",!0)])),_:1})])),_:1})])),_:1})])])])}],["__scopeId","data-v-e354a246"]]);export{$ as default};
