{"version":3,"file":"list-dd492f25.js","sources":["../../src/views/map/list.vue"],"sourcesContent":["<template>\n  <div class=\"app-container\">\n    <el-card shadow=\"never\" class=\"search-wrapper\">\n      <el-form ref=\"searchFormRef\" :inline=\"true\" :model=\"searchData\">\n        <el-form-item prop=\"version\" label=\"版本号\">\n          <el-input v-model=\"searchData.version\" placeholder=\"请输入版本号\" />\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"initQuery\">查询</el-button>\n          <el-button @click=\"resetSearch\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n    <div class=\"flex\">\n      <el-button type=\"primary\" @click=\"data.isShowMapPop = true\"\n        >上传Sourcemap</el-button\n      >\n    </div>\n    <el-card class=\"mt20\">\n      <div class=\"table-wrapper\">\n        <el-table border :data=\"data.tableData\">\n          <el-table-column prop=\"id\" label=\"ID\" align=\"center\" />\n          <el-table-column prop=\"filename\" label=\"文件名\" align=\"center\" />\n          <el-table-column prop=\"version\" label=\"版本号\" align=\"center\" />\n          <el-table-column  label=\"存储大小\" align=\"center\">\n            <template #default=\"{ row }\">\n              {{ (row.size / 1024).toFixed(2) }}\n            </template>\n          </el-table-column>\n          <el-table-column prop=\"updateTime\" label=\"上传时间\" align=\"center\" />\n        </el-table>\n      </div>\n      <div class=\"pager-wrapper mt20 justify-end\">\n        <el-pagination\n          background\n          :layout=\"paginationData.layout\"\n          :page-sizes=\"paginationData.pageSizes\"\n          :total=\"paginationData.total\"\n          :page-size=\"paginationData.pageSize\"\n          :currentPage=\"paginationData.currentPage\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n        />\n      </div>\n    </el-card>\n    <el-dialog\n      v-model=\"data.isShowMapPop\"\n      title=\"上传Sourcemap\"\n      width=\"60%\"\n      :before-close=\"handleClose\"\n    >\n      <el-form\n        ref=\"ruleFormRef\"\n        :model=\"ruleForm\"\n        :rules=\"rules\"\n        label-width=\"120px\"\n        :size=\"'default'\"\n        status-icon\n        class=\"pop-form\"\n      >\n        <el-form-item label=\"版本号\" prop=\"version\">\n          <el-input v-model=\"ruleForm.version\" />\n        </el-form-item>\n        <el-form-item label=\"文件\">\n          <el-upload\n            multiple\n            ref=\"uploadRef\"\n            class=\"upload-demo\"\n            :file-list=\"data.attFilesList\"\n            :headers=\"data.headers\"\n            :data=\"ruleForm\"\n            :action=\"data.actionUrl\"\n            :auto-upload=\"false\"\n            :on-success=\"successFile\"\n            accept=\".map\"\n          >\n            <template #trigger>\n              <el-button type=\"primary\">选择map文件</el-button>\n            </template>\n          </el-upload>\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"submitForm(ruleFormRef)\">\n            保存\n          </el-button>\n          <el-button @click=\"resetForm(ruleFormRef)\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </el-dialog>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { ref, reactive, onMounted } from \"vue\";\nimport { usePagination } from \"@/hooks/usePagination\";\nimport { sourcemapList } from '@/api/map/index'\nimport type { FormInstance, FormRules, UploadInstance } from \"element-plus\";\nimport { getCookie, getToken } from \"@/utils/cache/cookies\";\nimport { baseURL } from \"@/utils/service\";\n\ninterface RuleForm {\n  version: \"\";\n}\n\nexport default {\n  setup() {\n    const searchData = ref({\n      version: \"\",\n    });\n    let data = reactive({\n      isShowMapPop: false, // 弹窗\n      attFilesList: <any>[],\n      tableData: <any>[],\n      actionUrl: `${baseURL}/adm/sourcemap/save`,\n      headers: {\n        Authorization: getToken() ? `${getToken()}` : undefined,\n        MonitorAppId: getCookie(\"PROJECT_ID\")\n      },\n    });\n\n    const { paginationData, handleCurrentChange, handleSizeChange } =\n      usePagination(() => {\n        initQuery();\n      });\n    const initQuery = async () => {\n      let param = {\n        page: paginationData.currentPage,\n        pageSize: paginationData.pageSize,\n        ...searchData.value\n      }\n      let res = await sourcemapList(param)\n      if (!res.success) {\n        return\n      }\n      paginationData.total = res.model.count;\n      data.tableData = res.model.list;\n    };\n    const resetSearch = () => {\n      searchData.value = {\n        version: \"\",\n      };\n      paginationData.currentPage = 1;\n    };\n\n    const handleClose = () => {\n      data.isShowMapPop = false;\n    };\n\n    const uploadRef = ref<UploadInstance>();\n    const ruleFormRef = ref<FormInstance>();\n    const ruleForm: any = reactive<RuleForm>({\n      version: \"\",\n    });\n    const rules = reactive<FormRules<RuleForm>>({\n      version: [\n        {\n          required: true,\n          message: \"请输入版本号\",\n          trigger: \"blur\",\n        },\n      ],\n    });\n\n    const submitForm = async (formEl: FormInstance | undefined) => {\n      if (!formEl) return;\n      await formEl.validate(async (valid, fields) => {\n        if (valid) {\n            uploadRef.value!.submit()\n        } else {\n          console.log(\"error submit!\", fields);\n        }\n      });\n    };\n\n    const resetForm = (formEl: FormInstance | undefined) => {\n      if (!formEl) return;\n      formEl.resetFields();\n      data.attFilesList = []\n    };\n    // 上传成功回调\n    const successFile = async (res: any) => {\n        console.log(res)\n        if (!res.success) {\n            return\n        }\n        data.attFilesList = []\n        ruleForm.version = \"\"\n        data.isShowMapPop = false;\n        initQuery()\n    }\n\n    onMounted(() => {\n      initQuery()\n    })\n    return {\n      searchData,\n      data,\n      initQuery,\n      resetSearch,\n      handleCurrentChange,\n      handleSizeChange,\n      paginationData,\n      handleClose,\n      ruleFormRef,\n      ruleForm,\n      rules,\n      submitForm,\n      uploadRef,\n      successFile,\n      resetForm\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.search-wrapper {\n  :deep(.el-form-item) {\n    margin-bottom: 0;\n  }\n}\n</style>\n"],"names":["_hoisted_1","class","setup","searchData","ref","version","data","reactive","isShowMapPop","attFilesList","tableData","actionUrl","baseURL","headers","Authorization","getToken","MonitorAppId","getCookie","paginationData","handleCurrentChange","handleSizeChange","usePagination","initQuery","async","param","page","currentPage","pageSize","value","res","sourcemapList","success","total","model","count","list","uploadRef","ruleFormRef","ruleForm","rules","required","message","trigger","onMounted","resetSearch","handleClose","submitForm","formEl","validate","valid","fields","submit","successFile","resetForm","resetFields","_component_el_dialog","_resolveComponent","_openBlock","_createElementBlock","_createVNode","_component_el_card","shadow","_withCtx","_component_el_form","inline","default","_component_el_form_item","prop","_component_el_input","modelValue","$setup","_cache","$event","_","_component_el_button","type","onClick","_createElementVNode","_hoisted_2","_hoisted_3","_component_el_table","border","_component_el_table_column","label","align","_hoisted_4","_component_el_pagination","background","layout","pageSizes","onSizeChange","title","width","size","_component_el_upload","multiple","action","accept"],"mappings":"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"}