{"version":3,"file":"list-9192e59a.js","sources":["../../src/views/resource/components/resHoursEchart.vue","../../src/views/resource/list.vue","../../src/api/resource/index.ts"],"sourcesContent":["<template>\n  <div class=\"flex\"></div>\n  <Echarts :options=\"options\"></Echarts>\n</template>\n\n<script lang=\"ts\">\nimport Echarts from \"@/components/echarts/index.vue\";\nimport { ref, watch } from \"vue\";\nimport moment from \"moment\";\nexport default {\n  components: {\n    Echarts,\n  },\n  props: {\n    echartsOptions: {\n      type: Object,\n      required: true,\n    },\n  },\n  setup(props) {\n    const options = ref({});\n\n    const init = () => {\n      let {\n        seriesData = [],\n        axisData = [],\n        seriesName = {},\n      } = props.echartsOptions;\n      seriesData = seriesData.map((item: any, index: string | number) => {\n        return {\n          ...{\n            name: seriesName[index],\n            type: \"bar\",\n            barGap: 0,\n            emphasis: {\n              focus: \"series\",\n            },\n            ...item,\n          },\n        };\n      });\n\n      options.value = {\n        xAxis: {\n          type: \"category\",\n          data: axisData,\n          axisLabel: {\n            color: \"#95979e\",\n            align: \"center\",\n            // interval: 0,\n            formatter: (value: string | any[], index: any) => {\n              const date = moment(value).format(\"MM-DD HH:mm\").split(\" \");\n              return `${date[0]}\\n${date[1]}`;\n            },\n          },\n        },\n        yAxis: {\n          type: \"value\",\n        },\n        dataZoom: [\n          {\n            type: \"inside\",\n          },\n          // {\n          // \ttype: \"slider\",\n          // },\n        ],\n        seriesColorReset: true,\n        series: [...seriesData],\n      };\n    };\n\n    init();\n\n    watch(() => props.echartsOptions,n => {\n      init()\n    })\n\n    return {\n      options,\n    };\n  },\n};\n</script>\n\n<style scoped></style>\n","<template>\n  <div class=\"app-container\">\n    <el-card v-loading=\"loading\" shadow=\"never\" class=\"search-wrapper\">\n      <el-form ref=\"searchFormRef\" :inline=\"true\" :model=\"searchData\">\n        <el-form-item prop=\"pageUrl\" label=\"页面链接\">\n          <el-input v-model=\"searchData.pageUrl\" placeholder=\"请输入\" />\n        </el-form-item>\n        <el-form-item prop=\"resourceType\" label=\"资源类型\">\n          <el-select v-model=\"searchData.resourceType\" placeholder=\"请选择\">\n            <el-option\n              v-for=\"item in resourceTypes\"\n              :key=\"item.value\"\n              :label=\"item.label\"\n              :value=\"item.value\"\n            />\n          </el-select>\n        </el-form-item>\n        <el-form-item prop=\"url\" label=\"资源链接\">\n          <el-input v-model=\"searchData.url\" placeholder=\"请输入\" />\n        </el-form-item>\n        <el-form-item prop=\"phone\" label=\"日期\">\n          <el-date-picker\n            v-model=\"searchData.data\"\n            type=\"datetimerange\"\n            range-separator=\"-\"\n            start-placeholder=\"开始时间\"\n            end-placeholder=\"结束时间\"\n          />\n        </el-form-item>\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"init\"\n            >查询</el-button\n          >\n          <el-button @click=\"resetSearch\">重置</el-button>\n        </el-form-item>\n      </el-form>\n    </el-card>\n    <el-card v-if=\"echartsOptions.seriesName\" shadow=\"always\" class=\"mt20 mb20\">\n        <ResHoursEchart :echartsOptions=\"echartsOptions\"></ResHoursEchart>\n    </el-card>\n    <el-card v-loading=\"loading\" shadow=\"never\">\n      <div class=\"table-wrapper\">\n        <el-table border :data=\"tableData\">\n          <el-table-column\n            prop=\"resourceType\"\n            label=\"错误类型\"\n            align=\"center\"\n          />\n          <el-table-column prop=\"errorMsg\" label=\"错误信息\" align=\"center\" />\n          <el-table-column prop=\"html\" label=\"HTML内容\" align=\"center\" />\n          <el-table-column prop=\"pageUrl\" label=\"上报页面\" align=\"center\" />\n          <el-table-column prop=\"happenTime\" label=\"上报时间\" align=\"center\" />\n          <el-table-column label=\"操作\" fixed=\"right\" align=\"center\">\n            <template #default=\"{ row }\">\n              <el-button type=\"text\" @click=\"handleDetail(row)\">\n                查看详情\n              </el-button>\n            </template>\n          </el-table-column>\n        </el-table>\n      </div>\n      <div class=\"pager-wrapper\">\n        <el-pagination\n          background\n          :layout=\"paginationData.layout\"\n          :page-sizes=\"paginationData.pageSizes\"\n          :total=\"paginationData.total\"\n          :page-size=\"paginationData.pageSize\"\n          :currentPage=\"paginationData.currentPage\"\n          @size-change=\"handleSizeChange\"\n          @current-change=\"handleCurrentChange\"\n        />\n      </div>\n    </el-card>\n  </div>\n  <DetailPopup v-if=\"perfNode.resourceType\" :perfNode=\"perfNode\" />\n</template>\n\n<script lang=\"ts\">\nimport ResHoursEchart from './components/resHoursEchart.vue'\nimport DetailPopup from '../../components/detailPopup.vue'\nimport { nextTick, onMounted, ref } from \"vue\";\nimport { timeQuantum } from \"@/utils/index\";\nimport { resourceList, resourceHour } from \"@/api/resource/index\";\nimport {\n  Search,\n  Refresh,\n  CirclePlus,\n  Delete,\n  Download,\n  RefreshRight,\n} from \"@element-plus/icons-vue\";\nimport { type ResourceResponseData } from \"@/api/resource/types/resource\";\nimport { usePagination } from \"@/hooks/usePagination\";\nexport default {\n  name: \"Resource\",\n  components: {\n    ResHoursEchart,\n    DetailPopup\n  },\n  setup() {\n    const loading = ref<boolean>(false);\n    const echartsOptions: any = ref({})\n    const resourceTypes: any = ref([\n      {\n        value: \"IMG\",\n        label: \"IMG\",\n      },\n      {\n        value: \"LINK\",\n        label: \"LINK\",\n      },\n      {\n        value: \"SCRIPT\",\n        label: \"SCRIPT\",\n      },\n    ]);\n    const searchData = ref({\n      pageUrl: \"\",\n      url: \"\",\n      resourceType: \"\",\n      data: timeQuantum({ format: [\"00:00:00\", \"23:59:59\"] }),\n    });\n    const perfNode: any = ref({});\n    const tableData = ref<ResourceResponseData[]>([]);\n\n    const { paginationData, handleCurrentChange, handleSizeChange } =\n      usePagination(() => {\n        handleSearch();\n      });\n\n    onMounted(() => {\n      handleSearch();\n      handleTb();\n    });\n\n    const init = async () => {\n      handleSearch();\n      handleTb();\n    };\n\n    const handleSearch = async () => {\n      let param = {\n        url: searchData.value.url,\n        pageUrl: searchData.value.pageUrl,\n        resourceType: searchData.value.resourceType,\n        startTime: searchData.value.data[0],\n        endTime: searchData.value.data[1],\n        page: paginationData.currentPage,\n        pageSize: paginationData.pageSize,\n      };\n      let res = await resourceList(param);\n      if (res.success) {\n        paginationData.total = res.model.count;\n        tableData.value = res.model.list;\n      }\n    };\n\n    const handleTb = async () => {\n      let param = {\n        startTime: searchData.value.data[0],\n        endTime: searchData.value.data[1],\n      };\n      let res = await resourceHour(param);\n      if (res.success) {\n        echartsOptions.value = res.model\n      }\n    };\n    const resetSearch = () => {\n      searchData.value = {\n        pageUrl: \"\",\n        url: \"\",\n        resourceType: \"\",\n        data: timeQuantum({ format: [\"00:00:00\", \"23:59:59\"] }),\n      };\n      handleSearch();\n      handleTb();\n    };\n\n    /**\n     * @description: 查看性能详情\n     * @param {*} row\n     * @return {*}\n     */\n    const handleDetail = (row: any) => {\n      perfNode.value = {};\n      nextTick(() => (perfNode.value = row));\n    };\n\n    return {\n      resourceTypes,\n      loading,\n      searchData,\n      resetSearch,\n      handleSearch,\n      Search,\n      Refresh,\n      CirclePlus,\n      RefreshRight,\n      Delete,\n      Download,\n      tableData,\n      paginationData,\n      handleCurrentChange,\n      handleSizeChange,\n      handleDetail,\n      perfNode,\n      init,\n      echartsOptions\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.search-wrapper {\n  margin-bottom: 20px;\n  display: flex;\n  :deep(.el-card__body) {\n    padding-bottom: 2px;\n  }\n}\n\n.toolbar-wrapper {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 20px;\n}\n\n.table-wrapper {\n  margin-bottom: 20px;\n}\n\n.pager-wrapper {\n  display: flex;\n  justify-content: flex-end;\n}\n</style>\n","import { request } from \"@/utils/service\";\nimport type * as Resource from \"./types/resource\";\n\n/**\n * 获取资源错误列表\n * @returns\n */\nexport function resourceList(data: Resource.ResourceListRequestData) {\n  return request<Resource.ResourceListResponseData>({\n    url: \"/adm/resource/list\",\n    method: \"post\",\n    data,\n  });\n}\n\n/**\n * 图表数据\n * @param data \n * @returns \n */\nexport function resourceHour(data: Resource.ResourceHourRequestData) {\n  return request<Resource.ResourceHourResponseData>({\n    url: \"/adm/resource/hour\",\n    method: \"post\",\n    data,\n  });\n}\n"],"names":["_sfc_main$1","components","Echarts","props","echartsOptions","type","Object","required","setup","options","ref","init","seriesData","axisData","seriesName","map","item","index","name","barGap","emphasis","focus","value","xAxis","data","axisLabel","color","align","formatter","date","moment","format","split","yAxis","dataZoom","seriesColorReset","series","watch","n","_hoisted_1","class","ResHoursEchart","_openBlock","_Fragment","DetailPopup","loading","resourceTypes","label","searchData","pageUrl","url","resourceType","timeQuantum","perfNode","tableData","paginationData","handleCurrentChange","handleSizeChange","usePagination","onMounted","handleSearch","async","param","startTime","endTime","page","currentPage","pageSize","res","request","method","success","total","model","count","list","handleTb","resetSearch","Search","Refresh","CirclePlus","RefreshRight","Delete","Download","handleDetail","row","nextTick","_createElementVNode","_withDirectives","_createBlock","_component_el_card","shadow","_withCtx","_createVNode","_component_el_form","inline","default","_component_el_form_item","prop","_component_el_input","modelValue","$setup","_cache","$event","_","_component_el_select","_createElementBlock","_renderList","_component_el_option","key","_component_el_date_picker","_component_el_button","onClick","_directive_loading","_createCommentVNode","_hoisted_2","_component_el_table","border","_component_el_table_column","fixed","_hoisted_3","_component_el_pagination","background","layout","pageSizes","onSizeChange","_component_DetailPopup"],"mappings":"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"}