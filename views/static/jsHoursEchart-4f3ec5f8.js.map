{"version":3,"file":"jsHoursEchart-4f3ec5f8.js","sources":["../../src/api/js/index.ts","../../src/components/jsComponents/jsHoursEchart.vue"],"sourcesContent":["import { request } from \"@/utils/service\";\nimport type * as Js from \"./types/index\";\n\n/**\n * js 每小时图表\n * @param data\n * @returns\n */\nexport function jsHourEchats(data: Js.JsHourEchatsRequestData) {\n  return request<Js.JsHourEchatsResponseData>({\n    url: \"/adm/js/echart/hour\",\n    method: \"post\",\n    data,\n  });\n}\n\n/**\n * js 表格\n * @returns\n */\nexport function jsList(data: Js.JsListRequestData) {\n  return request<Js.JsListResponseData>({\n    url: \"/adm/js/list\",\n    method: \"post\",\n    data,\n  });\n}\n\n/**\n * js 错误 errorMsg 分组\n * @param data \n * @returns \n */\nexport function aggregateErrorByErrorMsg(data: Js.ErrorByErrorMsgRequestData) {\n  return request<Js.ErrorByErrorMsgResponseData>({\n    url: \"/adm/js/aggregate/error/by/errormsg\",\n    method: \"post\",\n    data,\n  });\n}","<template>\n  <div class=\"flex js-error-tip\">\n    <el-statistic title=\"错误数\" :value=\"data.jseErrorCount\"></el-statistic>\n    <el-statistic :value=\"data.errorTypeList.length\" value-style=\"color: #29c1c2;\">\n      <template #title>\n        <el-popover placement=\"bottom-start\" :width=\"200\" trigger=\"hover\">\n          <template #reference>\n            <div>错误类型</div>\n          </template>\n          <div class=\"popover-content\">\n            <p v-for=\"(item, index) in data.errorTypeList\" :key=\"index\">{{ item.type }}</p>\n          </div>\n        </el-popover>\n      </template>\n    </el-statistic>\n    <el-statistic :value=\"data.effectUserList.length\" value-style=\"color: #29c1c2;\">\n      <template #title>\n        <el-popover placement=\"bottom-start\" :width=\"200\" trigger=\"hover\">\n          <template #reference>\n            <div>影响人数</div>\n          </template>\n          <div class=\"popover-content\">\n            <p v-for=\"(item, index) in data.effectUserList\" :key=\"index\">{{ item.uuId }}</p>\n          </div>\n        </el-popover>\n      </template>\n    </el-statistic>\n    <el-statistic :value=\"data.cregionList.length\" value-style=\"color: #29c1c2;\">\n      <template #title>\n        <el-popover placement=\"bottom-start\" :width=\"200\" trigger=\"hover\">\n          <template #reference>\n            <div>影响城市</div>\n          </template>\n          <div class=\"popover-content\">\n            <p v-for=\"(item, index) in data.cregionList\" :key=\"index\">{{ item.province }}</p>\n          </div>\n        </el-popover>\n      </template>\n    </el-statistic>\n    <el-statistic :value=\"data.pageList.length\" value-style=\"color: #29c1c2;\">\n      <template #title>\n        <el-popover placement=\"bottom-start\" :width=\"200\" trigger=\"hover\">\n          <template #reference>\n            <div>影响页面</div>\n          </template>\n          <div class=\"popover-content\">\n            <p v-for=\"(item, index) in data.pageList\" :key=\"index\">{{ item.pageUrl }}</p>\n          </div>\n        </el-popover>\n      </template>\n    </el-statistic>\n  </div>\n  <Echarts :options=\"data.jsErrorChartData\"></Echarts>\n</template>\n\n<script lang=\"ts\">\nimport { onMounted, reactive, nextTick, watch } from \"vue\";\nimport Echarts from \"@/components/echarts/index.vue\";\nimport { jsHourEchats } from \"@/api/js/index\";\nimport moment from \"moment\";\nexport default {\n  props: {\n    params: {\n      type: Object,\n      default: {},\n    },\n  },\n  components: {\n    Echarts,\n  },\n  setup(props) {\n    const data = reactive({\n      jsErrorChartData: <any>[],\n      effectUserList: <any>[],\n      cregionList: <any>[],\n      pageList: <any>[],\n      errorTypeList: <any>[],\n      jseErrorCount: 0,\n    });\n    // js 图表\n    const handleQueryJsError = async (dataParam: any) => {\n      const param = {\n        pageUrl: dataParam.pageUrl || \"\",\n        errorMsg: dataParam.errorMsg || \"\",\n        startTime: dataParam.data[0],\n        endTime: dataParam.data[1],\n        simpleUrl: dataParam.simpleUrl || \"\",\n      };\n      let res = await jsHourEchats(param);\n      if (!res.success) {\n        return;\n      }\n      const { model } = res;\n      const {\n        axisData = [],\n        seriesData = [],\n        userList = [],\n        cregionList = [],\n        pageList = [],\n        errorTypeList = [],\n        errorCount = 0,\n      }: any = model;\n      const jsErrorOption = {\n        xAxis: {\n          type: \"category\",\n          data: axisData,\n          axisLabel: {\n            color: \"#95979e\",\n            align: \"center\",\n            // interval: 0,\n            formatter: (value: string | any[]) => {\n              const date = moment(value).format(\"MM-DD HH:mm\").split(\" \");\n              return `${date[0]}\\n${date[1]}`;\n            },\n          },\n        },\n        yAxis: {\n          type: \"value\",\n        },\n        dataZoom: [\n          {\n            type: \"inside\",\n          },\n          // {\n          // \ttype: \"slider\",\n          // },\n        ],\n        series: [\n          {\n            name: \"数量\",\n            data: seriesData,\n            type: \"line\",\n          },\n        ],\n      };\n\n      data.jsErrorChartData = jsErrorOption;\n      data.jseErrorCount = errorCount;\n      data.effectUserList = userList;\n      data.cregionList = cregionList;\n      data.pageList = pageList;\n      data.errorTypeList = errorTypeList;\n      data.jseErrorCount = errorCount;\n    };\n\n    watch(\n      () => props.params,\n      (n) => {\n        if (Object.keys(n).length) {\n          nextTick(() => handleQueryJsError(n));\n        }\n      },\n      {\n        deep: true,\n        // immediate: true,\n      }\n    );\n\n    onMounted(() => {\n      handleQueryJsError(props.params);\n    });\n\n    return {\n      data,\n    };\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.js-error-tip {\n  margin-bottom: 20px;\n  :deep(.el-statistic) {\n    margin-right: 20px;\n  }\n}\n.popover-content {\n  max-height: 200px;\n  overflow-y: auto;\n  p {\n    padding: 5px 0;\n    border-bottom: 1px dotted #d9dadd;\n    white-space: nowrap;\n    &:last-child {\n      border-bottom-width: 0;\n    }\n  }\n}\n</style>\n"],"names":["jsList","data","request","url","method","aggregateErrorByErrorMsg","_sfc_main","props","params","type","Object","default","components","Echarts","setup","reactive","jsErrorChartData","effectUserList","cregionList","pageList","errorTypeList","jseErrorCount","handleQueryJsError","async","dataParam","param","pageUrl","errorMsg","startTime","endTime","simpleUrl","res","jsHourEchats","success","model","axisData","seriesData","userList","errorCount","jsErrorOption","xAxis","axisLabel","color","align","formatter","value","date","moment","format","split","yAxis","dataZoom","series","name","watch","n","keys","length","nextTick","deep","onMounted","_withScopeId","_pushScopeId","_popScopeId","_hoisted_1","class","_hoisted_2","_createElementVNode","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_openBlock","_createElementBlock","_Fragment","_createVNode","_component_el_statistic","title","$setup","_withCtx","_component_el_popover","placement","width","trigger","_renderList","item","index","_","_hoisted_9"],"mappings":"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"}